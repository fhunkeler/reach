/*!
 * The MIT License (MIT)
 * 
 * Copyright (c) 2015 Webcom
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Reach=t():e.Reach=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Reach=void 0;var r=n(63),i=o(r),a=n(64),c=o(a),s=n(54),u=(o(s),n(22)),d=o(u),l=n(55),f=o(l),p=n(56),h=o(p),v=n(57),m=o(v),g=n(59),b=o(g),S=t.Reach=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?"http://webcom.orange.com/base/webrtc":arguments[0];(0,i["default"])(this,e),this.datarefs=(0,f["default"])(t),this.webrtcmngr=(0,b["default"])(this.datarefs),this.webrtcmngr.setWebrtcManger(this.webrtcmngr)}return(0,c["default"])(e,[{key:"Room",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return m["default"].apply(void 0,t.concat([this.datarefs,this.webrtcmngr]))}},{key:"Reach",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return h["default"].apply(void 0,t.concat([this.datarefs]))}}],[{key:"version",get:function(){return"1.1.0"}},{key:"actions",get:function(){return d["default"]}}]),e}();e.exports=S},function(e,t,n){var o=n(31)("wks"),r=n(21),i=n(2).Symbol,a="function"==typeof i,c=e.exports=function(e){return o[e]||(o[e]=a&&i[e]||(a?i:r)("Symbol."+e))};c.store=o},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(e,t,n){var o=n(10);e.exports=function(e){if(!o(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){e.exports=!n(14)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var o=n(4),r=n(40),i=n(33),a=Object.defineProperty;t.f=n(5)?Object.defineProperty:function(e,t,n){if(o(e),t=i(t,!0),o(n),r)try{return a(e,t,n)}catch(c){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var o=n(6),r=n(19);e.exports=n(5)?function(e,t,n){return o.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var o=n(78),r=n(26);e.exports=function(e){return o(r(e))}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var o=n(25);e.exports=function(e,t,n){if(o(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,o){return e.call(t,n,o)};case 3:return function(n,o,r){return e.call(t,n,o,r)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var o=n(2),r=n(3),i=n(12),a=n(8),c="prototype",s=function(e,t,n){var u,d,l,f=e&s.F,p=e&s.G,h=e&s.S,v=e&s.P,m=e&s.B,g=e&s.W,b=p?r:r[t]||(r[t]={}),S=b[c],w=p?o:h?o[t]:(o[t]||{})[c];p&&(n=t);for(u in n)d=!f&&w&&void 0!==w[u],d&&u in b||(l=d?w[u]:n[u],b[u]=p&&"function"!=typeof w[u]?n[u]:m&&d?i(l,o):g&&w[u]==l?function(e){var t=function(t,n,o){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,o)}return e.apply(this,arguments)};return t[c]=e[c],t}(l):v&&"function"==typeof l?i(Function.call,l):l,v&&((b.virtual||(b.virtual={}))[u]=l,e&s.R&&S&&!S[u]&&a(S,u,l)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,e.exports=s},function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t){e.exports={}},function(e,t,n){var o=n(46),r=n(28);e.exports=Object.keys||function(e){return o(e,r)}},function(e,t,n){e.exports={"default":n(66),__esModule:!0}},function(e,t){e.exports=!0},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var o=n(6).f,r=n(7),i=n(1)("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,i)&&o(e,i,{configurable:!0,value:t})}},function(e,t){var n=0,o=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+o).toString(36))}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={ACTION_TYPE_AUDIO:"audio",ACTION_TYPE_VIDEO:"video",ACTION_TYPE_CHAT:"chat",ACTION_TYPE_AUDIO_VIDEO:"audio-video",ACTION_TYPE_SCREEN_SHARING:"screen-sharing",ACTION_TYPE_CALL:"call"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function t(){return""+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var n=t();return{appInstanceId:n}}();t["default"]=n},function(e,t,n){e.exports={"default":n(68),__esModule:!0}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var o=n(10),r=n(2).document,i=o(r)&&o(r.createElement);e.exports=function(e){return i?r.createElement(e):{}}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var o=n(31)("keys"),r=n(21);e.exports=function(e){return o[e]||(o[e]=r(e))}},function(e,t,n){var o=n(2),r="__core-js_shared__",i=o[r]||(o[r]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t){var n=Math.ceil,o=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?o:n)(e)}},function(e,t,n){var o=n(10);e.exports=function(e,t){if(!o(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!o(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!o(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!o(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var o=n(2),r=n(3),i=n(18),a=n(35),c=n(6).f;e.exports=function(e){var t=r.Symbol||(r.Symbol=i?{}:o.Symbol||{});"_"==e.charAt(0)||e in t||c(t,e,{value:a.f(e)})}},function(e,t,n){t.f=n(1)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(37),i=o(r),a=function(){function e(){return _.length>0?i["default"].resolve(_):navigator.mediaDevices.enumerateDevices().then(function(e){return _=e.filter(function(e){return/^videoinput$/.test(e.kind)})})}function t(t){console.log("(ReachSDK::localstream::initVideo)"),S||(S=!0,e().then(function(e){navigator.getMedia=getUserMedia,m=document.createElement("VIDEO"),m.muted=!0;var n=void 0,o=void 0;e[R]&&(o=e[R].deviceId);var r={audio:{deviceId:n?{exact:n}:void 0},video:{deviceId:o?{exact:o}:void 0}};null===d||o?navigator.getMedia(r,function(e){console.log(e),d=e,c.forEach(function(e){attachMediaStream(e,d)}),p.forEach(function(e){e(d)}),C.forEach(function(e){e(d)}),p=[],S=!1,t&&t()},function(e){console.error("Error on webrtcLocalStream - webkitGetUserMedia : error="),console.dir(e),S=!1,t&&t(e)}):(c.forEach(function(e){attachMediaStream(e,d)}),p.forEach(function(e){e(d)}),p=[],S=!1)}))}function n(e){console.log("(ReachSDK::localstream::initAudio)"),w||(w=!0,navigator.getMedia=getUserMedia,g=document.createElement("AUDIO"),g.muted=!0,s.push(g),null===l?navigator.getMedia({audio:!0,video:!1},function(t){l=t,s.forEach(function(e){attachMediaStream(e,l)}),s=[],h.forEach(function(e){e(l)}),h=[],w=!1,e&&e()},function(t){console.error("Error on webrtcLocalStream - webkitGetUserMedia :error="),console.dir(t),w=!1,e&&e(t)}):(s.forEach(function(e){attachMediaStream(e,l)}),s=[],h.forEach(function(e){e(l)}),h=[],w=!1))}function o(t){console.log("(ReachSDK::localstream::initAudioVideo)"),y||(y=!0,e().then(function(e){navigator.getMedia=getUserMedia,b=document.createElement("AUDIOVIDEO"),b.muted=!0;var n=void 0,o=void 0;e[R]&&(o=e[R].deviceId);var r={audio:{deviceId:n?{exact:n}:void 0},video:{deviceId:o?{exact:o}:void 0}};null===f||o?navigator.getMedia(r,function(e){f=e,u.forEach(function(e){attachMediaStream(e,f)}),v.forEach(function(e){e(f)}),I.forEach(function(e){e(f)}),v=[],y=!1,t&&t()},function(e){console.error("(ReachSDK::localstream::initAudioVideo::Error on webrtcLocalStream - webkitGetUserMedia : error="),console.dir(e),y=!1,t&&t(e)}):(u.forEach(function(e){attachMediaStream(e,f)}),v.forEach(function(e){e(f)}),v=[],y=!1)}))}function r(){console.log("(ReachSDK::localstream::_switchCamera)"),_.length>0&&(R=++R%_.length,f&&(console.log("(ReachSDK::localstream::_switchCamera)::streamAudioVideo"),f.getTracks().forEach(function(e){e.stop()}),o()),d&&(console.log("(ReachSDK::localstream::_switchCamera)::streamVideo"),d.getTracks().forEach(function(e){e.stop()}),t()))}function a(){console.log("(ReachSDK::localstream::close)"),m&&(detachMediaStream(m),m=null),f&&(f.getTracks().forEach(function(e){e.stop()}),f=null),d&&(d.getTracks().forEach(function(e){e.stop()}),d=null),S=!1,g&&(detachMediaStream(g),g=null),l&&(l.stop(),l=null),w=!1,b&&(detachMediaStream(b),b=null),f&&(f.stop(),f=null),y=!1}var c=[],s=[],u=[],d=null,l=null,f=null,p=[],h=[],v=[],m=null,g=null,b=null,S=!1,w=!1,y=!1,_=[],R=0,I=[],C=[];return{getVideoStream:function(){return d},addVideoListener:function(e){p.push(e)},initVideo:function(){t()},connectLocalVideoStream:function(e,n,o){e?(e.muted=!0,d?(console.log("(ReachSDK::localstream::connectLocalVideoStream)use existing streamVideo"),attachMediaStream(e,d),o&&"function"==typeof o&&o(d)):(c.push(e),o&&"function"==typeof o&&p.push(o),t(n))):d?o&&"function"==typeof o&&o(d):(o&&"function"==typeof o&&p.push(o),t(n))},getAudioStream:function(){return l},addAudioListener:function(e){h.push(e)},initAudio:function(){n()},connectLocalAudioStream:function(e,t,o){e?(e.muted=!0,l?(console.log("(ReachSDK::localstream::connectLocalAudioStream)use existing streamAudio"),attachMediaStream(e,l),o&&"function"==typeof o&&o(l)):(s.push(e),o&&"function"==typeof o&&h.push(o),n(t))):l?o&&"function"==typeof o&&o(l):(o&&"function"==typeof o&&h.push(o),n(t))},getAudioVideoStream:function(){return f},addAudioVideoListener:function(e){v.push(e)},initAudioVideo:function(){o()},connectLocalAudioVideoStream:function(e,t,n){e?(e.muted=!0,f?(console.log("(ReachSDK::localstream::connectLocalAudioVideoStream)use existing streamAudioVideo"),attachMediaStream(e,f),n&&n(f)):(u.push(e),n&&"function"==typeof n&&v.push(n),o(t))):f?n&&n(f):(n&&"function"==typeof n&&v.push(n),o(t))},close:function(){a()},switchCamera:function(){r()},addStreamAudioVideoListener:function(e){I.push(e)},addStreamVideoListener:function(e){C.push(e)},getAllVideoSources:function(){return e()},getVideoSourceNumber:function(){return e().then(function(e){return e.length})}}}();t["default"]=a},function(e,t,n){e.exports={"default":n(69),__esModule:!0}},function(e,t,n){var o=n(11),r=n(1)("toStringTag"),i="Arguments"==o(function(){return arguments}()),a=function(e,t){try{return e[t]}catch(n){}};e.exports=function(e){var t,n,c;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=a(t=Object(e),r))?n:i?o(t):"Object"==(c=o(t))&&"function"==typeof t.callee?"Arguments":c}},function(e,t,n){e.exports=n(2).document&&document.documentElement},function(e,t,n){e.exports=!n(5)&&!n(14)(function(){return 7!=Object.defineProperty(n(27)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){"use strict";var o=n(18),r=n(13),i=n(47),a=n(8),c=n(7),s=n(15),u=n(82),d=n(20),l=n(90),f=n(1)("iterator"),p=!([].keys&&"next"in[].keys()),h="@@iterator",v="keys",m="values",g=function(){return this};e.exports=function(e,t,n,b,S,w,y){u(n,t,b);var _,R,I,C=function(e){if(!p&&e in E)return E[e];switch(e){case v:return function(){return new n(this,e)};case m:return function(){return new n(this,e)}}return function(){return new n(this,e)}},D=t+" Iterator",T=S==m,k=!1,E=e.prototype,O=E[f]||E[h]||S&&E[S],P=O||C(S),M=S?T?C("entries"):P:void 0,A="Array"==t?E.entries||O:O;if(A&&(I=l(A.call(new e)),I!==Object.prototype&&(d(I,D,!0),o||c(I,f)||a(I,f,g))),T&&O&&O.name!==m&&(k=!0,P=function(){return O.call(this)}),o&&!y||!p&&!k&&E[f]||a(E,f,P),s[t]=P,s[D]=g,S)if(_={values:T?P:C(m),keys:w?P:C(v),entries:M},y)for(R in _)R in E||i(E,R,_[R]);else r(r.P+r.F*(p||k),t,_);return _}},function(e,t,n){var o=n(4),r=n(88),i=n(28),a=n(30)("IE_PROTO"),c=function(){},s="prototype",u=function(){var e,t=n(27)("iframe"),o=i.length,r=">";for(t.style.display="none",n(39).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write("<script>document.F=Object</script"+r),e.close(),u=e.F;o--;)delete u[s][i[o]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(c[s]=o(e),n=new c,c[s]=null,n[a]=e):n=u(),void 0===t?n:r(n,t)}},function(e,t,n){var o=n(29),r=n(19),i=n(9),a=n(33),c=n(7),s=n(40),u=Object.getOwnPropertyDescriptor;t.f=n(5)?u:function(e,t){if(e=i(e),t=a(t,!0),s)try{return u(e,t)}catch(n){}return c(e,t)?r(!o.f.call(e,t),e[t]):void 0}},function(e,t,n){var o=n(46),r=n(28).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return o(e,r)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var o=n(7),r=n(9),i=n(74)(!1),a=n(30)("IE_PROTO");e.exports=function(e,t){var n,c=r(e),s=0,u=[];for(n in c)n!=a&&o(c,n)&&u.push(n);for(;t.length>s;)o(c,n=t[s++])&&(~i(u,n)||u.push(n));return u}},function(e,t,n){e.exports=n(8)},function(e,t,n){var o,r,i,a=n(12),c=n(77),s=n(39),u=n(27),d=n(2),l=d.process,f=d.setImmediate,p=d.clearImmediate,h=d.MessageChannel,v=0,m={},g="onreadystatechange",b=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},S=function(e){b.call(e.data)};f&&p||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return m[++v]=function(){c("function"==typeof e?e:Function(e),t)},o(v),v},p=function(e){delete m[e]},"process"==n(11)(l)?o=function(e){l.nextTick(a(b,e,1))}:h?(r=new h,i=r.port2,r.port1.onmessage=S,o=a(i.postMessage,i,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(o=function(e){d.postMessage(e+"","*")},d.addEventListener("message",S,!1)):o=g in u("script")?function(e){s.appendChild(u("script"))[g]=function(){s.removeChild(this),b.call(e)}}:function(e){setTimeout(a(b,e,1),0)}),e.exports={set:f,clear:p}},function(e,t,n){var o=n(32),r=Math.min;e.exports=function(e){return e>0?r(o(e),9007199254740991):0}},function(e,t,n){var o=n(26);e.exports=function(e){return Object(o(e))}},function(e,t){},function(e,t,n){"use strict";var o=n(96)(!0);n(41)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=o(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){n(99);for(var o=n(2),r=n(8),i=n(15),a=n(1)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],s=0;5>s;s++){var u=c[s],d=o[u],l=d&&d.prototype;l&&!l[a]&&r(l,a,u),i[u]=i.Array}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){return new a["default"](function(t,n){getUserMedia(e,t,n)})}var i=n(37),a=o(i),c=n(17),s=o(c),u=n(24),d=o(u),l=n(65),f=o(l);window.getUserMedia=null,window.attachMediaStream=null,window.detachMediaStream=null,window.reattachMediaStream=null,window.webrtcDetectedBrowser=null;var p=null,h=null,v={log:function(){},extractVersion:function(e,t,n){var o=e.match(t);return o&&o.length>=n&&parseInt(o[n],10)}};if("object"===("undefined"==typeof window?"undefined":(0,f["default"])(window))&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(e){"mozSrcObject"in this?e?this.mozSrcObject=e:this.mozSrcObject="":e?(this._srcObject=e,this.src=URL.createObjectURL(e)):(this._srcObject="",this.src="")}}),getUserMedia=window.navigator&&window.navigator.getUserMedia),detachMediaStream=function(e){e&&("undefined"!=typeof e.srcObject?e.srcObject=null:"undefined"!=typeof e.mozSrcObject?e.mozSrcObject="":"undefined"!=typeof e.src?e.src="":console.log("Error attaching stream to element."))},attachMediaStream=function(e,t){console.log("(ReachSDK::adapt::attachMediaStream1)"),e.srcObject=t,e.autoplay=!0,e.play&&"function"==typeof e.play&&e.play()},reattachMediaStream=function(e,t){e.srcObject=t.srcObject,e.autoplay=!0,e.play&&"function"==typeof e.play&&e.play()},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia){if(v.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",p=v.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),h=31,window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(38>p&&e&&e.iceServers){for(var n=[],o=0;o<e.iceServers.length;o++){var r=e.iceServers[o];if(r.hasOwnProperty("urls"))for(var i=0;i<r.urls.length;i++){var a={url:r.urls[i]};0===r.urls[i].indexOf("turn")&&(a.username=r.username,a.credential=r.credential),n.push(a)}else n.push(e.iceServers[o])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?mozRTCPeerConnection.generateCertificate.apply(null,arguments):mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),getUserMedia=function(e,t,n){var o=function(e){if("object"!==("undefined"==typeof e?"undefined":(0,f["default"])(e))||e.require)return e;var t=[];return(0,d["default"])(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var o=e[n]="object"===(0,f["default"])(e[n])?e[n]:{ideal:e[n]};if(void 0===o.min&&void 0===o.max&&void 0===o.exact||t.push(n),void 0!==o.exact&&("number"==typeof o.exact?o.min=o.max=o.exact:e[n]=o.exact,delete o.exact),void 0!==o.ideal){e.advanced=e.advanced||[];var r={};"number"==typeof o.ideal?r[n]={min:o.ideal,max:o.ideal}:r[n]=o.ideal,e.advanced.push(r),delete o.ideal,(0,d["default"])(o).length||delete e[n]}}}),t.length&&(e.require=t),e};return 38>p&&(v.log("spec: "+(0,s["default"])(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),v.log("ff37: "+(0,s["default"])(e))),navigator.mozGetUserMedia(e,t,n)},navigator.getUserMedia=getUserMedia,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:r,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new a["default"](function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},41>p){var m=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return m().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){v.log("This appears to be Chrome"),webrtcDetectedBrowser="chrome",p=v.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),h=38,window.RTCPeerConnection=function(e,t){e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new webkitRTCPeerConnection(e,t),o=n.getStats.bind(n);return n.getStats=function(e,t,n){var r=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return o(e,t);var c=function(e){var t={},n=e.result();return n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t};if(arguments.length>=2){var s=function(e){i[1](c(e))};return o.apply(this,[s,arguments[0]])}return new a["default"](function(t,n){1===i.length&&null===e?o.apply(r,[function(e){t.apply(null,[c(e)])},n]):o.apply(r,[t,n])})},n},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?webkitRTCPeerConnection.generateCertificate.apply(null,arguments):webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===(0,f["default"])(arguments[0])){var n=1===arguments.length?arguments[0]:void 0;return new a["default"](function(o,r){t.apply(e,[o,r,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this;return new a["default"](function(o,r){t.apply(n,[e[0],function(){o(),e.length>=2&&e[1].apply(null,[])},function(t){r(t),e.length>=3&&e[2].apply(null,[t])}])})}});var g=function(e){if("object"!==("undefined"==typeof e?"undefined":(0,f["default"])(e))||e.mandatory||e.optional)return e;var t={};return(0,d["default"])(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var o="object"===(0,f["default"])(e[n])?e[n]:{ideal:e[n]};void 0!==o.exact&&"number"==typeof o.exact&&(o.min=o.max=o.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==o.ideal){t.optional=t.optional||[];var i={};"number"==typeof o.ideal?(i[r("min",n)]=o.ideal,t.optional.push(i),i={},i[r("max",n)]=o.ideal,t.optional.push(i)):(i[r("",n)]=o.ideal,t.optional.push(i))}void 0!==o.exact&&"number"!=typeof o.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=o.exact):["min","max"].forEach(function(e){void 0!==o[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=o[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};if(getUserMedia=function(e,t,n){return e.audio&&(e.audio=g(e.audio)),e.video&&(e.video=g(e.video)),v.log("chrome: "+(0,s["default"])(e)),navigator.webkitGetUserMedia(e,t,n)},navigator.getUserMedia=getUserMedia,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:r,enumerateDevices:function(){return new a["default"](function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var b=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return v.log("spec:   "+(0,s["default"])(e)),e.audio=g(e.audio),e.video=g(e.video),v.log("chrome: "+(0,s["default"])(e)),b(e)}}else navigator.mediaDevices.getUserMedia=function(e){return r(e)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){v.log("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){v.log("Dummy mediaDevices.removeEventListener called.")}),attachMediaStream=function(e,t){console.log("(ReachSDK::adapt::attachMediaStream2)"),p>=43?(e.srcObject=t,e.autoplay=!0):"undefined"!=typeof e.src?(e.src=URL.createObjectURL(t),e.autoplay=!0):v.log("Error attaching stream to element.")},reattachMediaStream=function(e,t){p>=43?e.srcObject=t.srcObject:e.src=t.src,e.autoplay=!0,e.play&&"function"==typeof e.play&&e.play()}}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){if(v.log("This appears to be Edge"),webrtcDetectedBrowser="edge",p=v.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),h=10547,window.RTCIceGatherer){var S=function(){return Math.random().toString(36).substr(2,10)},w=S(),y={};y.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},y.splitSections=function(e){var t=e.split("\r\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},y.matchPrefix=function(e,t){return y.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},y.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},o=8;o<t.length;o+=2)switch(t[o]){case"raddr":n.relatedAddress=t[o+1];break;case"rport":n.relatedPort=parseInt(t[o+1],10);break;case"tcptype":n.tcpType=t[o+1]}return n},y.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},y.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},y.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},y.parseFmtp=function(e){for(var t,n={},o=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<o.length;r++)t=o[r].trim().split("="),n[t[0].trim()]=t[1];return n},y.writeFtmp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&e.parameters.length){var o=[];(0,d["default"])(e.parameters).forEach(function(t){o.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+o.join(";")+"\r\n"}return t},y.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},y.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+" "+e.parameter+"\r\n"}),t},y.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:e.substr(7,t-7)},o=e.indexOf(":",t);return o>-1?(n.attribute=e.substr(t+1,o-t-1),n.value=e.substr(o+1)):n.attribute=e.substr(t+1),n},y.getDtlsParameters=function(e,t){var n=y.splitLines(e);n=n.concat(y.splitLines(t));var o=n.filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14),r={role:"auto",fingerprints:[{algorithm:o.split(" ")[0],value:o.split(" ")[1]}]};return r},y.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},y.getIceParameters=function(e,t){var n=y.splitLines(e);n=n.concat(y.splitLines(t));var o={usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return o},y.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},y.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=y.splitLines(e),o=n[0].split(" "),r=3;r<o.length;r++){var i=o[r],a=y.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){var c=y.parseRtpMap(a),s=y.matchPrefix(e,"a=fmtp:"+i+" ");c.parameters=s.length?y.parseFmtp(s[0]):{},c.rtcpFeedback=y.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(y.parseRtcpFb),t.codecs.push(c)}}return t},y.writeRtpDescription=function(e,t){var n="";return n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=y.writeRtpMap(e),n+=y.writeFtmp(e),n+=y.writeRtcpFb(e)}),n+="a=rtcp-mux\r\n"},y.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},y.writeMediaSection=function(e,t,n,o){var r=y.writeRtpDescription(e.kind,t);if(r+=y.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=y.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),r+="a=mid:"+e.mid+"\r\n",r+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var i="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n";r+="a="+i,r+="a=ssrc:"+e.sendSsrc+" "+i}return r+="a=ssrc:"+e.sendSsrc+" cname:"+w+"\r\n"},y.getDirection=function(e,t){for(var n=y.splitLines(e),o=0;o<n.length;o++)switch(n[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[o].substr(2)}return t?y.getDirection(t):"sendrecv"},window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e}),window.RTCPeerConnection=function(e){var t=this;if(this.onicecandidate=null,this.onaddstream=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new D({type:"",sdp:""}),this.remoteDescription=new D({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}e&&e.iceServers&&e.iceServers.forEach(function(e){if(e.urls){var n;n="string"==typeof e.urls?e.urls:e.urls[0],-1!==n.indexOf("transport=udp")&&t.iceServers.push({username:e.username,credential:e.credential,urls:n})}}),this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this;this._localIceCandidatesBuffer.forEach(function(t){null!==e.onicecandidate&&e.onicecandidate(t)}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var o=0;o<t.codecs.length;o++){var r=t.codecs[o];if(e.name.toLowerCase()===r.name.toLowerCase()&&e.clockRate===r.clockRate&&e.numChannels===r.numChannels){n.codecs.push(r);break}}}),e.headerExtensions.forEach(function(e){for(var o=0;o<t.headerExtensions.length;o++){var r=t.headerExtensions[o];if(e.uri===r.uri){n.headerExtensions.push(r);break}}}),n},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var n=this,o=new RTCIceGatherer(n.iceOptions),r=new RTCIceTransport(o);o.onlocalcandidate=function(i){var a={};a.candidate={sdpMid:e,sdpMLineIndex:t};var c=i.candidate;c&&0!==(0,d["default"])(c).length?(c.component="RTCP"===r.component?2:1,a.candidate.candidate=y.writeCandidate(c)):(void 0===o.state&&(o.state="completed"),a.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates");
var s=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});null!==n.onicecandidate&&(n.localDescription&&""===n.localDescription.type?(n._localIceCandidatesBuffer.push(a),s&&n._localIceCandidatesBuffer.push({})):(n.onicecandidate(a),s&&n.onicecandidate({})))},r.onicestatechange=function(){n._updateConnectionState()};var i=new RTCDtlsTransport(r);return i.ondtlsstatechange=function(){n._updateConnectionState()},i.onerror=function(){i.state="failed",n._updateConnectionState()},{iceGatherer:o,iceTransport:r,dtlsTransport:i}},window.RTCPeerConnection.prototype._transceive=function(e,t,n){var o=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(o.encodings=[{ssrc:e.sendSsrc}],o.rtcp={cname:w,ssrc:e.recvSsrc},e.rtpSender.send(o)),n&&e.rtpReceiver&&(o.encodings=[{ssrc:e.recvSsrc}],o.rtcp={cname:e.cname,ssrc:e.sendSsrc},e.rtpReceiver.receive(o))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t=this;if("offer"===e.type)this._pendingOffer&&(this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){var n=y.splitSections(t.remoteDescription.sdp),o=n.shift();n.forEach(function(e,n){var r=t.transceivers[n],i=r.iceGatherer,a=r.iceTransport,c=r.dtlsTransport,s=r.localCapabilities,u=r.remoteCapabilities,d="0"===e.split("\n",1)[0].split(" ",2)[1];if(!d){var l=y.getIceParameters(e,o);a.start(i,l,"controlled");var f=y.getDtlsParameters(e,o);c.start(f);var p=t._getCommonCapabilities(s,u);t._transceive(r,p.codecs.length>0,!1)}})}switch(this.localDescription=e,e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var r=arguments.length>1&&"function"==typeof arguments[1];if(r){var i=arguments[1];window.setTimeout(function(){i(),t._emitBufferedCandidates()},0)}var c=a["default"].resolve();return c.then(function(){r||window.setTimeout(t._emitBufferedCandidates.bind(t),0)}),c},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,n=new MediaStream,o=y.splitSections(e.sdp),r=o.shift();switch(o.forEach(function(o,i){var a,c,s,u,d,l,f,p,h,v,m,g=y.splitLines(o),b=g[0].substr(2).split(" "),S=b[0],w="0"===b[1],_=y.getDirection(o,r),R=y.parseRtpParameters(o);w||(v=y.getIceParameters(o,r),m=y.getDtlsParameters(o,r));var I,C=y.matchPrefix(o,"a=mid:")[0].substr(6),D=y.matchPrefix(o,"a=ssrc:").map(function(e){return y.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];if(D&&(p=parseInt(D.ssrc,10),I=D.value),"offer"===e.type){var T=t._createIceAndDtlsTransports(C,i);if(h=RTCRtpReceiver.getCapabilities(S),f=1001*(2*i+2),l=new RTCRtpReceiver(T.dtlsTransport,S),n.addTrack(l.track),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=i){var k=t.localStreams[0].getTracks()[i];d=new RTCRtpSender(k,T.dtlsTransport)}t.transceivers[i]={iceGatherer:T.iceGatherer,iceTransport:T.iceTransport,dtlsTransport:T.dtlsTransport,localCapabilities:h,remoteCapabilities:R,rtpSender:d,rtpReceiver:l,kind:S,mid:C,cname:I,sendSsrc:f,recvSsrc:p},t._transceive(t.transceivers[i],!1,"sendrecv"===_||"sendonly"===_)}else"answer"!==e.type||w||(a=t.transceivers[i],c=a.iceGatherer,s=a.iceTransport,u=a.dtlsTransport,d=a.rtpSender,l=a.rtpReceiver,f=a.sendSsrc,h=a.localCapabilities,t.transceivers[i].recvSsrc=p,t.transceivers[i].remoteCapabilities=R,t.transceivers[i].cname=I,s.start(c,v,"controlling"),u.start(m),t._transceive(a,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!l||"sendrecv"!==_&&"sendonly"!==_?delete a.rtpReceiver:n.addTrack(l.track))}),this.remoteDescription=e,e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return window.setTimeout(function(){null!==t.onaddstream&&n.getTracks().length&&(t.remoteStreams.push(n),window.setTimeout(function(){t.onaddstream({stream:n})},0))},0),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),a["default"].resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e,null!==this.onsignalingstatechange&&this.onsignalingstatechange()},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){null!==this.onnegotiationneeded&&this.onnegotiationneeded()},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,n={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n["new"]>0?e="new":(n.connecting>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState&&(t.iceConnectionState=e,null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange())},window.RTCPeerConnection.prototype.createOffer=function(){var e=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var t;1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var n=[],o=0,r=0;if(this.localStreams.length&&(o=this.localStreams[0].getAudioTracks().length,r=this.localStreams[0].getVideoTracks().length),t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(o=t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(r=t.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){n.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?o>0:r>0}),"audio"===e.kind?o--:"video"===e.kind&&r--});o>0||r>0;)o>0&&(n.push({kind:"audio",wantReceive:!0}),o--),r>0&&(n.push({kind:"video",wantReceive:!0}),r--);var i=y.writeSessionBoilerplate(),c=[];n.forEach(function(t,n){var o,r,a=t.track,s=t.kind,u=S(),d=e._createIceAndDtlsTransports(u,n),l=RTCRtpSender.getCapabilities(s),f=1001*(2*n+1);a&&(o=new RTCRtpSender(a,d.dtlsTransport)),t.wantReceive&&(r=new RTCRtpReceiver(d.dtlsTransport,s)),c[n]={iceGatherer:d.iceGatherer,iceTransport:d.iceTransport,dtlsTransport:d.dtlsTransport,localCapabilities:l,remoteCapabilities:null,rtpSender:o,rtpReceiver:r,kind:s,mid:u,sendSsrc:f,recvSsrc:null};var p=c[n];i+=y.writeMediaSection(p,p.localCapabilities,"offer",e.localStreams[0])}),this._pendingOffer=c;var s=new D({type:"offer",sdp:i});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,s),a["default"].resolve(s)},window.RTCPeerConnection.prototype.createAnswer=function(){var e,t=this;1===arguments.length&&"function"!=typeof arguments[0]?e=arguments[0]:3===arguments.length&&(e=arguments[2]);var n=y.writeSessionBoilerplate();this.transceivers.forEach(function(e){var o=t._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);n+=y.writeMediaSection(e,o,"answer",t.localStreams[0])});var o=new D({type:"answer",sdp:n});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,o),a["default"].resolve(o)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var o=this.transceivers[t];if(o){var r=(0,d["default"])(e.candidate).length>0?y.parseCandidate(e.candidate):{};if("tcp"===r.protocol&&0===r.port)return;if("1"!==r.component)return;"endOfCandidates"===r.type&&(r={}),o.iceTransport.addRemoteCandidate(r)}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),a["default"].resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new a["default"](function(n){var o={};a["default"].all(e).then(function(e){e.forEach(function(e){(0,d["default"])(e).forEach(function(t){o[t]=e[t]})}),t&&window.setTimeout(t,0,o),n(o)})})}}}else v.log("Browser does not appear to be WebRTC-capable");else v.log("This does not appear to be a browser"),webrtcDetectedBrowser="not a browser";"object"!==("undefined"==typeof window?"undefined":(0,f["default"])(window))||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){"chrome"===webrtcDetectedBrowser&&e.stream.addEventListener("addtrack",function(n){var o=new Event("track");o.track=n.track,o.receiver={track:n.track},o.streams=[e.stream],t.dispatchEvent(o)}),e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}});var _={};try{Object.defineProperty(_,"version",{set:function(e){p=e}})}catch(R){}var I,C,D;"undefined"!=typeof window&&(I=window.RTCPeerConnection,C=window.RTCIceCandidate,D=window.RTCSessionDescription),e.exports={RTCPeerConnection:I,RTCIceCandidate:C,RTCSessionDescription:D,getUserMedia:getUserMedia,attachMediaStream:attachMediaStream,reattachMediaStream:reattachMediaStream,webrtcDetectedBrowser:webrtcDetectedBrowser,webrtcDetectedVersion:p,webrtcMinimumVersion:h,webrtcTesting:_,webrtcUtils:v}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){function t(){m=v.child("roomsList"),g=v.child("reach"),b=v.child("webrtc"),S=v.child("sipPhoneNumbers")}function n(){v=new Webcom(e),t()}function o(e){v=new Webcom(e),t()}function r(){return v?v.toString():void 0}function i(e){v=e,t()}function a(){return v}function c(e){m=e}function s(){return m}function u(e){g=e}function d(){return g}function l(e){b=e}function f(){return b}function p(e){S=e}function h(){return S}var v=null,m=null,g=null,b=null,S=null;return n(),{setWebcomBaseUrl:o,getWebcomBaseUrl:r,setDatastore:i,getDatastore:a,setRooms:c,getRooms:s,setReach:u,getReach:d,setWebrtc:l,getWebrtc:f,setSipPhoneNumbers:p,getSipPhoneNumbers:h}}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(24),i=o(r),a=n(17),c=o(a),s=n(23),u=o(s),d="ONGOING",l="ACCEPTED",f="REJECTED",p="CANCELED",h="CONNECTED",v="OPEN",m=function(e,t){function n(){U=P.child("userList/"+O+"/connectedList/"+u["default"].appInstanceId),U.onDisconnect().remove(),U.child("status").set(h);try{!function(){var e=U.child("description");u["default"].appInstanceId&&e.child("appInstanceId").set(u["default"].appInstanceId);var t={},n=["appCodeName","appName","appVersion","buildID","cookieEnabled","language","onLine","oscpu","platform","product","productSub","securityPolicy","userAgent","vendor","vendorSub"];n.forEach(function(e){navigator[e]&&(t[e]=navigator[e])}),e.child("navigator").set(t)}()}catch(e){console.error("(ReachSDK::reach::init)failed to get information about device. error="+e)}P.child("userList/"+O+"/wasInsideReach").set(!0)}function o(e,t){console.log("(ReachSDK::reach::_isConnected)userId: "+e),P.child("userList/"+e+"/connectedList").once("value",function(e){t&&"function"==typeof t&&t(null!==e.val())})}function r(e,t){console.log("(ReachSDK::reach::_isRegistered)userId: "+e),P.child("userList/"+e+"/wasInsideReach").once("value",function(e){t&&"function"==typeof t&&t(null!==e.val())})}function a(e){U&&U.child("status").set(e)}function s(e){M&&(P.child("userList").off("child_added",M),M=null),e&&"function"==typeof e&&(M=function(t){console.log("(ReachSDK::reach::onUserAddedCb) "+t.name()+"="+(0,c["default"])(t.val()));var n={};n[t.name()]=t.val(),e(n)},P.child("userList").on("child_added",M))}function m(e){A&&(P.child("userList").off("child_changed",A),A=null),e&&"function"==typeof e&&(A=function(t){console.log("(ReachSDK::reach::onUserChangedCb) "+t.name()+"="+(0,c["default"])(t.val()));var n={};n[t.name()]=t.val(),e(n)},P.child("userList").on("child_changed",A))}function g(e){x&&(P.child("userList").off("child_removed",x),x=null),e&&"function"==typeof e&&(x=function(t){console.log("(ReachSDK::reach::onUserRemovedCb) "+t.name()+"="+(0,c["default"])(t.val()));var n={};n[t.name()]=t.val(),e(n)},P.child("userList").on("child_removed",x))}function b(e){K&&(P.child("invitationList/"+O).off("child_added",K),K=null),e&&"function"==typeof e&&(K=function(t){t.val().status===d&&!function(){console.log("(ReachSDK::reach::_setOnNewRoomInvitation)new Invite received,id) "+t.name()+",content="+(0,c["default"])(t.val()));var n=t.name();V||(V=[]),V[n]&&(V[n].timeout&&clearTimeout(V[n].timeout),delete V[n]),V[n]={};var o={};o[n]=t.val(),e(o);var r=P.child("invitationList/"+O+"/"+n);W&&(V[n].timeout=setTimeout(function(){W&&(console.log("(ReachSDK::reach::_setOnNewRoomInvitation)automatic reject of Invite received="+(0,c["default"])(t.val())),r.onDisconnect().cancel(),N?r.update({timestamp_end:Webcom.ServerValue.TIMESTAMP,status:f,status_info:N}):r.update({timestamp_end:Webcom.ServerValue.TIMESTAMP,status:f}))},W)),r.once("child_changed",function(e){e&&"status"===e.name()&&e.ref().parent().once("value",function(t){var n=void 0,o=void 0;if(t){n=e.ref().parent().name(),o=t.val();var r={};r[n]=o,V&&V[n]&&V[n].timeout&&clearTimeout(V[n].timeout),console.log("(ReachSDK::reach::_setOnNewRoomInvitation)Invite changed,id=) "+n+", new content="+(0,c["default"])(o)),r&&L&&L(r),delete V[n]}})})}()},P.child("invitationList/"+O).on("child_added",K))}function S(e){L&&(L=null),e&&"function"==typeof e&&(L=e)}function w(e,t){W&&(W=null),N&&(N=null),e&&e===parseInt(e,10)&&e>0&&(console.log("(ReachSDK::reach::_setNewRoomInvitationTimeout)timeout="+e),W=e),t&&(N=t)}function y(e,n,o){return console.log("(ReachSDK::reach::_isUserPresentInRoom)p_roomId="+e+" p_user="+n),e&&"string"==typeof e?n&&"string"==typeof n?o&&"function"==typeof o?void t.getRooms().child(e+"/participantList/"+n+"/wasInsideRoom").once("value",function(t){var r=null!==t.val();console.log("(ReachSDK::reach::_isUserPresentInRoom)p_roomId="+e+",p_user="+n+",result="+r),o(r,e,n)}):void console.error("(ReachSDK::reach::_isUserPresentInRoom)parameter p_cb is incorrect. if defined, expecting a function"):void console.error("(ReachSDK::reach::_isUserPresentInRoom)parameter p_user is incorrect. Expecting non empty string"):void console.error("(ReachSDK::reach::_isUserPresentInRoom)parameter p_roomid is incorrect. Expecting non empty string")}function _(e,t,n){return e&&"string"==typeof e?t&&!t instanceof Array?void console.error("(ReachSDK::reach::_cancelInvitation)parameter p_guestIds is incorrect. Expecting an Array"):(console.log(" (ReachSDK::reach::_cancelInvitation)p_roomId="+e+", p_guestIds="+(0,c["default"])(t)),void(j&&j[e]?t?t.forEach(function(t,o){t&&"string"==typeof t?j[e][t]?j[e][t].InviteDataref?(j[e][t].InviteDataref.onDisconnect().cancel(),j[e][t].InviteChangedCb&&"function"==typeof j[e][t].InviteChangedCb&&j[e][t].InviteDataref.off("child_changed",j[e][t].InviteChangedCb),j[e][t].InviteDataref.once("value",function(o){var r=void 0,i=void 0,a=void 0;o&&o.val()&&(r=o.val().status,a=o.val().room,i=o.ref().parent().name(),r&&r===d?(j[a][i].InviteDataref.update({timestamp_end:Webcom.ServerValue.TIMESTAMP,status:p}),j[a][i].statusChangedCb&&"function"==typeof j[a][i].statusChangedCb&&j[a][i].statusChangedCb(a,i,p),console.log("(ReachSDK::reach::_cancelInvitation)deleting Invite to room "+a+" for invitee "+i)):console.warn("(ReachSDK::reach::_cancelInvitation)cannot delete intivation to room "+a+" for guest "+i+" Invitation has been removed/rejected/accepted")),delete j[e][t],n&&"function"==typeof n&&n(t)})):(delete j[e][t],n&&"function"==typeof n&&n(t)):n&&"function"==typeof n&&n(t):console.error("(ReachSDK::reach::inviteToRoom)parameter p_guestIds["+o+"] is incorrect. Expecting non empty string")}):(0,i["default"])(j[e]).forEach(function(t){_(e,[t],n)}):console.warn("(ReachSDK::reach::_cancelInvitation) Invite to room "+e+" not found"))):void console.error("(ReachSDK::reach::_cancelInvitation)parameter p_roomid is incorrect. Expecting non empty string")}function R(e,n,o,r){if(!e||"string"!=typeof e)return void console.error("(ReachSDK::reach::inviteToRoom)parameter p_roomid is incorrect. Expecting non empty string");if(!o||"string"!=typeof o)return void console.error("(ReachSDK::reach::inviteToRoom)parameter p_topic is incorrect. Expecting non empty string");if(r&&"function"!=typeof r&&console.warn("(ReachSDK::reach::inviteToRoom)parameter p_statusChangedCb is incorrect. if defined, expecting a function"),!(n&&n instanceof Array))return void console.error("(ReachSDK::reach::inviteToRoom)parameter p_guestIds is incorrect. Expecting an Array");t.getRooms().child(e).child("commonDataList").update({status:v,owner:O});var i=function(e,n,o){e||t.getRooms().child(n+"/participantList/"+o).update({connected:!1,wasInsideRoom:!1})},a=function(t){if(console.log("(ReachSDK::reach::inviteToRoom::_InviteChangedCb)"),t&&"status"===t.name()){var n=t.ref().parent().parent().name();console.log("(ReachSDK::reach::inviteToRoom::_InviteChangedCb)cb_guestId2="+n),j&&j[e]&&j[e][n]&&j[e][n].InviteChangedCb&&j[e][n].InviteDataref.off("child_changed",j[e][n].InviteChangedCb),t.ref().parent().once("value",function(e){var t=void 0,n=void 0,o=void 0,r=void 0;e?(t=e.val().status,o=e.val().room,r=e.val().status_info,n=e.ref().parent().name(),console.log("(ReachSDK::reach::inviteToRoom::_InviteChangedCb)roomId="+o+" invitee="+n+" new invitation status="+t+" status info="+r),j&&j[o]&&j[o][n]&&j[o][n].InviteDataref?(j[o][n].InviteDataref.onDisconnect().cancel(),j[o][n].statusChangedCb&&"function"==typeof j[o][n].statusChangedCb?j[o][n].statusChangedCb(o,n,t,r):console.warn("(ReachSDK::reach::inviteToRoom::_InviteChangedCb)cannot retrieve mathing p_statusChangedCb"),delete j[o][n]):console.warn("(ReachSDK::reach::inviteToRoom::_InviteChangedCb)cannot retrieve mathing mOutgoingInvite")):console.warn("(ReachSDK::reach::inviteToRoom::_InviteChangedCb)cannot retrieve invitation")})}};n.forEach(function(t,n){if(t&&"string"==typeof t){if(console.log("(ReachSDK::reach::inviteToRoom)roomId="+e+" invitee="+t.toString()),j[e]&&j[e][t])return void _(e,[t],function(n){n&&n===t&&R(e,[n],o,r)});j[e]||(j[e]=[]),j[e][t]={},y(e,t,i),j[e][t].InviteDataref=P.child("invitationList").child(t).push({from:O,room:e,timestamp_creation:Webcom.ServerValue.TIMESTAMP,topic:o,status:d}),console.log("(ReachSDK::reach::inviteToRoom)InviteDataref="+j[e][t].InviteDataref.toString()),j[e][t].InviteChangedCb=a,j[e][t].InviteDataref.on("child_changed",j[e][t].InviteChangedCb),j[e][t].statusChangedCb=r,j[e][t].InviteDataref.onDisconnect().update({timestamp_end:Webcom.ServerValue.TIMESTAMP,status:p})}else console.error("(ReachSDK::reach::inviteToRoom)parameter p_guestIds["+n+"] is incorrect. Expecting non empty string")})}function I(e){var t=(0,i["default"])(e)[0];return t?e[t]?void P.child("invitationList/"+O+"/"+t).once("value",function(n){var o=void 0,r=void 0,i=void 0;n&&n.val()&&(i=n.name(),o=n.val().status,r=n.ref().parent().name(),o&&o===d?(console.log("(ReachSDK::reach::_acceptInvitation)inviteId="+t+",data="+(0,c["default"])(e[t])),P.child("invitationList/"+r+"/"+i).update({timestamp_end:Webcom.ServerValue.TIMESTAMP,status:l})):console.warn("(ReachSDK::reach::_acceptInvitation)inviteId="+i+",data="+(0,c["default"])(e[t])+", cannot be accepted. It has been removed or canceled"))}):void console.error("(ReachSDK::reach::_acceptInvitation)parameter p_invitation is incorrect. cannot get invitation data"):void console.error("(ReachSDK::reach::_acceptInvitation)parameter p_invitation is incorrect. cannot get invitation Id")}function C(e,t){var n=(0,i["default"])(e)[0];return n?e[n]?void P.child("invitationList/"+O+"/"+n).once("value",function(o){var r=void 0,i=void 0,a=void 0;o&&o.val()&&(a=o.name(),r=o.val().status,i=o.ref().parent().name(),r&&r===d?(console.log("(ReachSDK::reach::_rejectInvitation)inviteId="+n+",data="+(0,c["default"])(e[n])),t?P.child("invitationList/"+i+"/"+a).update({timestamp_end:Webcom.ServerValue.TIMESTAMP,status_info:t,status:f}):P.child("invitationList/"+i+"/"+a).update({timestamp_end:Webcom.ServerValue.TIMESTAMP,status:f})):console.warn("(ReachSDK::reach::_rejectInvitation)inviteId="+a+",data="+(0,c["default"])(e[n])+", cannot be rejected. It has been removed or canceled"))}):void console.error("(ReachSDK::reach::_rejectInvitation)parameter p_invitation is incorrect. cannot get invitation data"):void console.error("(ReachSDK::reach::_rejectInvitation)parameter p_invitation is incorrect. cannot get invitation Id")}function D(e,n){e&&n&&"function"==typeof n&&!function(){var o=(0,i["default"])(e)[0];console.log("(ReachSDK::reach::_isRoomActive)inviteId="+o);var r=e[o].room;t.getRooms().child(r+"/commonDataList/status").once("value",function(e){var t=e&&e.val()&&e.val()===v;console.log("(ReachSDK::reach::_isRoomActive)inviteId="+o+" result="+t),n(t)})}()}function T(e,t){console.log("(ReachSDK::reach::_archiveInvitations)userId="+e),P.child("invitationList/"+O).once("value",function(n){n&&n.hasChildren()?!function(){var o=n.numChildren(),r=0;n.forEach(function(n){if(n&&n.val())if(console.log("(ReachSDK::reach::_archiveInvitations)userId="+e+" inviteId="+n.name()),n.val().status===f||n.val().status===p)P.child("invitationListHistory/"+e+"/"+n.name()).update(n.val()),n.ref().remove(),r++,r>=o&&t&&"function"==typeof t&&t();else{var i={};i[n.name()]=n.val(),D(i,function(i){if(i)r++,r>=o&&t&&"function"==typeof t&&t();else{if(n.val().status===d){var a=n.val();a.status=p,P.child("invitationListHistory/"+e+"/"+n.name()).set(a)}else P.child("invitationListHistory/"+e+"/"+n.name()).set(n.val());n.ref().remove(),r++,r>=o&&t&&"function"==typeof t&&t()}})}else t&&"function"==typeof t&&t()})}():t&&"function"==typeof t&&t()})}function k(){console.log("(ReachSDK::reach::_close)"),K&&(P.child("invitationList").child(O).off("child_added",K),K=null),M&&(P.child("userList").off("child_added",M),M=null),A&&(P.child("userList").off("child_changed",A),A=null),x&&(P.child("userList").off("child_removed",x),x=null),j&&(j.forEach(function(e){j[e].forEach(function(e){e.InviteDataref&&(e.InviteDataref.onDisconnect().cancel(),e.InviteDataref.update({status:p,timestamp_end:Webcom.ServerValue.TIMESTAMP}))})}),j=[]),W&&(W=null),N&&(N=null),U&&(U.remove(),U=null)}function E(e,n,o){return console.log("(ReachSDK::reach::_isUserPresent) userId="+n),n&&"string"==typeof n?o&&"function"==typeof o?void t.getRooms().child(e+"/participantList/"+n+"/connected").once("value",function(e){var t=e.val();console.log("(ReachSDK::reach::_isUserPresent)userId="+n+",result="+t),o(!!t)}):void console.error("(ReachSDK::reach::_isUserPresent)parameter callback is incorrect. if defined, expecting a function"):void console.error("(ReachSDK::reach::_isUserPresent)parameter userId is incorrect. Expecting non empty string")}var O=e,P=t.getReach(),M=null,A=null,x=null,K=null,L=null,j=[],V=[],W=null,N=null,U=null;return n(),{getMe:function(){return O},isConnected:o,isRegistered:r,setConnectedStatus:a,setOnUserAdded:s,setOnUserChanged:m,setOnUserRemoved:g,inviteToRoom:R,cancelInvitation:_,setOnNewRoomInvitation:b,setOnRoomInvitationChanged:S,setNewRoomInvitationTimeout:w,archiveMyInvitations:function(e){return T(O,e)},acceptInvitation:I,rejectInvitation:C,on:function(e,t){switch(e){case"newRoomInvitation":b(t);break;case"roomInvitationChanged":S(t);break;case"userAdded":s(t);break;case"userChanged":m(t);break;case"userRemoved":g(t);break;default:return console.error("reach.set: no such event"),-1}},close:k,isUserPresent:E}};t["default"]=m},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(24),i=o(r),a=n(17),c=o(a);t["default"]=function(e,t,n,o){function r(e){console.log("(ReachSDK::room["+j+"]::_addAvailableStream)data="+(0,c["default"])(e)),U.push(e)}function a(e){if(console.log("(ReachSDK::room["+j+"]::_removeAvailableStream)streamId="+e),U&&e)for(var t=U.length-1;t>=0;t--)U[t]&&(0,i["default"])(U[t])[0]&&(0,i["default"])(U[t])[0]===e&&delete U[t]}function s(){J||(J=function(e){var t={},n=e.name(),o=e.val();console.log("(ReachSDK::room["+j+"]::onPublishedStreamForAvailableStream)stream="+(0,c["default"])(o)),t[n]=o,t[n].roomId=j,r(t)},W.child("publishedMediaList").on("child_added",J)),$||($=function(e){var t=e.name();console.log("(ReachSDK::room["+j+"]::onUnPublishedStreamForAvailableStream)stream="+t),a(t)},W.child("publishedMediaList").on("child_removed",$))}function d(){W.child("participantList/"+V).update({connected:!0,wasInsideRoom:!0}),W.child("participantList/"+V+"/connected").onDisconnect().set(!1),s()}function f(){return j}function v(){return V}function m(e){var t=W.child("participantList");q&&(t.off("child_added",q),q=null),Q&&(t.off("child_changed",Q),Q=null),e&&"function"==typeof e?(q=function(t){var n=t.name();t.val()&&t.val().connected&&t.val().wasInsideRoom&&(console.log("(ReachSDK::room["+j+"]::_setOnParticipantJoin) user has joined: "+n),e(n))},t.on("child_added",q),Q=function(t){var n=t.name();t.val()&&t.val().connected&&t.val().wasInsideRoom&&(console.log("(ReachSDK::room["+j+"]::_setOnParticipantJoin) user has joined: "+n),e(n))},t.on("child_changed",Q)):console.error("(ReachSDK::room["+j+"]::_setOnParticipantJoin)parameter incorrect. Expected function")}function g(e){X&&(W.child("participantList").off("child_changed",X),X=null),e&&"function"==typeof e?(X=function(t){var n=t.name();t.val()&&!t.val().connected&&t.val().wasInsideRoom&&(console.log("(ReachSDK::room["+j+"]::_setOnParticipantLeave) user has left: "+n),e(n))},W.child("participantList").on("child_changed",X)):console.error("(ReachSDK::room["+j+"]::_setOnParticipantLeave)parameter incorrect. Expected function")}function b(e){""!==e&&(console.log("(ReachSDK::room["+j+"]::sendInstantMessage)message="+e),W.child("instantMessageList").push({from:V,message:e,timestamp:Webcom.ServerValue.TIMESTAMP}))}function S(e){Y&&(W.child("instantMessageList").off("child_added",Y),Y=null),e&&"function"==typeof e?(Y=function(t){var n=t.val();console.log("(ReachSDK::room["+j+"]::_setOnInstantMessage)receive InstantMessage="+(0,c["default"])(n)),e(n)},W.child("instantMessageList").on("child_added",Y)):console.error("(ReachSDK::room["+j+"]::_setOnInstantMessage)parameter incorrect. Expected function")}function w(e,t,n,r){if(console.log("(ReachSDK::room["+j+"]::publishStream)roomId="+j+",streamId="+e+",me="+V+",actionType="+n),!e||"string"!=typeof e)return void console.error("(ReachSDK::reach::inviteToRoom)parameter streamId is incorrect. Expecting non empty string");var i=W.child("publishedMediaList").child(e),a=i.child("subscribersList"),s=function(){i.set({from:V,appInstanceId:p["default"].appInstanceId,actionType:n}),i.onDisconnect().remove();var r=function(r){var i=r.name(),a=r.val(),s=a.userId,u=a.peercoId,d=a.peercoRef,l=B[e]&&B[e].audio,f=B[e]&&B[e].video,p=e+"_pub";console.log("(ReachSDK::room["+j+"]::publishStream::addSubscribersListCb)subscriber "+s+" to stream "+e+" added "+(0,c["default"])(a)),N[p]||(N[p]=[]);var h=o.createWebrtc(t,i,function(){console.log("(ReachSDK::room["+j+"]::publishStream::addSubscribersListCb)subscriber "+s+" to stream "+e+" connection lost")},!0,n,u,d,l,f);N[p].push({stackId:h,subscriberId:s,isPublish:!0,peercoId:u,peercoRef:d,streamId:e})},s=function(t){var n=t.val().userId,r=N[e+"_pub"];if(n&&r){console.log("(ReachSDK::room["+j+"]::publishStream::removeSubscribersListCb)subscriber "+n+" to stream "+e+" removed");for(var i=r.length-1;i>=0;i--)r[i].subscriberId===n&&(o.closeWebrtc(r[i].stackId,!0),N[e+"_pub"].splice(i,1))}};F[e]={addSubscribersListCb:r,removeSubscribersListCb:s},a.on("child_added",r),a.on("child_removed",s)};n&&(n===u["default"].ACTION_TYPE_VIDEO?l["default"].connectLocalVideoStream(t,s,r):n===u["default"].ACTION_TYPE_AUDIO?l["default"].connectLocalAudioStream(t,s,r):n===u["default"].ACTION_TYPE_AUDIO_VIDEO&&l["default"].connectLocalAudioVideoStream(t,s,r))}function y(e){z&&(W.child("publishedMediaList").off("child_added",z),z=null),e&&"function"==typeof e?(z=function(t){var n={},o=t.name();n[o]=t.val(),n[o].roomId=j,e(n)},W.child("publishedMediaList").on("child_added",z)):console.error("(ReachSDK::room["+j+"]::_setOnPublishedStream)parameter incorrect. Expected function")}function _(e,t){console.log("(ReachSDK::room["+j+"]::unPublishStream)streamId "+e);var n=W.child("publishedMediaList/"+e),r=n.child("subscribersList"),i=e+"_pub";F[e]&&F[e].addSubscribersListCb&&r.off("child_added",F[e].addSubscribersListCb),F[e]&&F[e].removeSubscribersListCb&&r.off("child_removed",F[e].removeSubscribersListCb),delete F[e],delete B[e],n.onDisconnect().cancel(),n.remove(),N[i]&&N[i].length>0?!function(){for(var e=N[i].length,n=function(){e--,1>e&&(delete N[i],t&&"function"==typeof t&&t())},r=e-1;r>=0;r--)o.closeWebrtc(N[i][r].stackId,!0,n);l["default"].close()}():(delete N[i],t&&"function"==typeof t&&t())}function R(e){H&&(W.child("publishedMediaList").off("child_removed",H),H=null),e&&"function"==typeof e?(H=function(t){e(t.name())},W.child("publishedMediaList").on("child_removed",H)):console.error("(ReachSDK::room["+j+"]::_setOnUnPublishedStream)parameter incorrect. Expected function")}function I(e,t,r){var a=(0,i["default"])(e)[0],c=e[a].actionType;if(console.log("(ReachSDK::room["+j+"]::subscribeToStream)streamId "+a),F&&F[a])return c&&(c===u["default"].ACTION_TYPE_VIDEO?l["default"].connectLocalVideoStream(t,r):c===u["default"].ACTION_TYPE_AUDIO?l["default"].connectLocalAudioStream(t,r):c===u["default"].ACTION_TYPE_AUDIO_VIDEO&&l["default"].connectLocalAudioVideoStream(t,r)),a;var s=e[a].appInstanceId,d=W.child("publishedMediaList").child(a),f=d.child("subscribersList"),h=a+"_sub",v=void 0,m=void 0;N[h]?N[h]&&N[h][0]&&N[h][0].peercoId&&(v=N[h][0].peercoId):N[h]=[];var g=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};v||(v=Math.floor(Date.now()).toString()+g(0,1e6)),m=n.getWebrtc().push().name(),f.child(p["default"].appInstanceId).set({ts:Webcom.ServerValue.TIMESTAMP,userId:V,peercoId:v,peercoRef:m});var b=B[a]&&B[a].audio,S=B[a]&&B[a].video,w=o.createWebrtc(t,s,function(){},!1,c,v,m,b,S,r);return G||(G=function(e){var t=e.val().from+"-stream",n=t+"_sub";if(console.log("(ReachSDK::room["+j+"]::remoteUnpublishedCb)streamId "+n),N[n]){for(var r=0;r<N[n].length;)o.closeWebrtc(N[n][r].stackId,!1),r++;delete N[n]}},W.child("publishedMediaList").on("child_removed",G)),N[h].push({stackId:w,isPublish:!1,peercoId:v,peercoRef:m,streamId:a}),a}function C(e){console.log("(ReachSDK::room["+j+"]::unSubscribeFromStream)streamId "+e);var t=W.child("publishedMediaList").child(e),n=t.child("subscribersList"),r=e+"_sub";if(n.child(p["default"].appInstanceId).remove(),N[r]){for(var i=0;i<N[r].length;)N[r][i]&&o.closeWebrtc(N[r][i].stackId,!1),i++;delete N[r]}delete B[e]}function D(){return console.log("(ReachSDK::room["+j+"]::_getAvailableStreams)"),U}function T(e){if(console.log("(ReachSDK::room["+j+"]::_getAvailableStream)streamId="+e),U&&e)for(var t=U.length-1;t>=0;t--)if(U[t]&&(0,i["default"])(U[t])[0]&&(0,i["default"])(U[t])[0]===e)return U[t];return null}function k(){console.log("(ReachSDK::room["+j+"]::_removeAllAvailableStreams"),
U=[]}function E(e){return e&&"string"==typeof e?(console.log("(ReachSDK::room["+j+"]::_muteAudioStream)streamId="+e),B[e]||(B[e]={}),B[e].audio=!0,void(N&&[N[e+"_pub"],N[e+"_sub"]].forEach(function(e){if(e&&e.length>0)for(var t=e.length-1;t>=0;t--)o.muteAudioWebrtcStack(e[t].stackId)}))):void console.error("(ReachSDK::room["+j+"]::_muteAudioStream)parameter streamId is incorrect. Expecting non empty string")}function O(e){return e&&"string"==typeof e?(B[e]&&B[e].audio&&(B[e].audio=!1),console.log("(ReachSDK::room["+j+"]::_unmuteAudioStream)streamId="+e),void(N&&[N[e+"_pub"],N[e+"_sub"]].forEach(function(e){if(e&&e.length>0)for(var t=e.length-1;t>=0;t--)o.unmuteAudioWebrtcStack(e[t].stackId)}))):void console.error("(ReachSDK::room["+j+"]::_unmuteAudioStream)parameter streamId is incorrect. Expecting non empty string")}function P(e){return e&&"string"==typeof e?(console.log("(ReachSDK::room["+j+"]::_muteVideoStream)streamId="+e),B[e]||(B[e]={}),B[e].video=!0,void(N&&(console.log(N[e+"_pub"]),[N[e+"_pub"],N[e+"_sub"]].forEach(function(e){if(e&&e.length>0)for(var t=e.length-1;t>=0;t--)o.muteVideoWebrtcStack(e[t].stackId)})))):void console.error("(ReachSDK::room["+j+"]::_muteVideoStream)parameter streamId is incorrect. Expecting non empty string")}function M(e){return e&&"string"==typeof e?(B[e]&&B[e].video&&(B[e].video=!1),console.log("(ReachSDK::room["+j+"]::_unmuteVideoStream)streamId="+e),void(N&&[N[e+"_pub"],N[e+"_sub"]].forEach(function(e){if(e&&e.length>0)for(var t=e.length-1;t>=0;t--)o.unmuteVideoWebrtcStack(e[t].stackId)}))):void console.error("(ReachSDK::room["+j+"]::_unmuteVideoStream)parameter streamId is incorrect. Expecting non empty string")}function A(e){console.log("(ReachSDK::room["+j+"]::_close)room "+j+", detroyRoom="+e);var t=W.child("participantList"),n=W.child("publishedMediaList");t.child(V+"/connected").set(!1),(0,i["default"])(F).forEach(_),F=[],Y&&(W.child("instantMessageList").off("child_added",Y),Y=null),z&&(n.off("child_added",z),z=null),J&&(n.off("child_added",J),J=null),H&&(n.off("child_removed",H),H=null),$&&(n.off("child_removed",$),$=null),q&&(t.off("child_added",q),q=null),Q&&(t.off("child_changed",Q),Q=null),X&&(t.off("child_changed",X),X=null),G&&(n.off("child_removed",G),G=null),(0,i["default"])(N).forEach(function(e){N[e].forEach(function(t){e&&t&&!function(){var e=t.streamId,n=t.stackId,r=t.isPublish;r?_(e):C(e),setTimeout(function(){o.clearWebrtcStacks(n)},1e3)}()})}),setTimeout(function(){N={},B=[],k()},1100),e&&e===!0&&W.child("commonDataList/status").set(h),l["default"].close()}function x(){l["default"].switchCamera()}function K(){return l["default"].getAllVideoSources()}function L(){return l["default"].getVideoSourceNumber()}var j=t,V=e,W=n.getRooms().child(j),N={},U=[],F=[],B=[],G=null,Y=null,z=null,J=null,H=null,$=null,q=null,Q=null,X=null;return d(),{getRoomId:f,getMe:v,setOnParticipantJoin:m,setOnParticipantLeave:g,sendInstantMessage:b,setOnInstantMessage:S,publishStream:w,setOnPublishedStream:y,unPublishStream:_,setOnUnPublishedStream:R,subscribeToStream:I,unSubscribeFromStream:C,getAvailableStreams:D,getAvailableStream:T,muteAudioStream:E,unmuteAudioStream:O,muteVideoStream:P,unmuteVideoStream:M,close:A,on:function(e,t){switch(e){case"instantMessage":S(t);break;case"publishedStream":y(t);break;case"unPublishedStream":R(t);break;case"participantJoin":m(t);break;case"participantLeave":g(t);break;default:console.err("(ReachSDK::room["+j+"]::on)unsupported "+e+" event")}},switchCamera:x,getAllVideoSources:K,getVideoSourceNumber:L}};var s=n(22),u=o(s),d=n(36),l=o(d),f=n(23),p=o(f),h="CLOSE"},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=o(r),a=n(22),c=o(a),s=n(36),u=o(s),d="disconnected",l="connected",f="completed",p="checking",h="closed",v="failed",m="other",g={iceServers:[{url:"turns:turn1.webcom.orange.com:443",username:"admin",credential:"webcom1234"},{url:"turn:turn2.webcom.orange.com:443",username:"admin",credential:"webcom1234"},{url:"turns:turn3.webcom.orange.com:443",username:"admin",credential:"webcom1234"}]},b=function(e,t,n,o,r,a,s,b){function S(e){console.log("(ReachSDK::webrtc::)stackId="+W+"error="+e),console.dir(e)}function w(e,t){console.log("ReachSDK::webrtc::getIceServersConfigFromServer"),F?F.root().child("config").once("value",function(n){var o=n?n.val():null;o?"function"==typeof e&&e(o):"function"==typeof t&&t()},function(e){"function"==typeof t&&t(e)}):"function"==typeof t&&t()}function y(){B.child("iceCandidatesList").on("child_added",G)}function _(){B.child("iceCandidatesList").off("child_added",G)}function R(e,t){t&&t.forEach(function(t){t&&(t.enabled=e)})}function I(e){de=e;var t=N&&ie?ie:!N&&re?re:null;t&&R(!de,t.getAudioTracks())}function C(){console.log("(ReachSDK::webrtc::_muteAudio)stackId="+W),I(!0)}function D(){console.log("(ReachSDK::webrtc::_unmuteAudio)stackId="+W),I(!1)}function T(e){le=e;var t=N&&ie?ie:!N&&re?re:null;t&&R(!le,t.getVideoTracks())}function k(){console.log("(ReachSDK::webrtc::_muteVideo)stackId="+W),T(!0)}function E(){console.log("(ReachSDK::webrtc::_unmuteVideo)stackId="+W),T(!1)}function O(e){console.debug("(ReachSDK::webrtc::_initSdpCallbacks)stackId="+W),Y&&(B.off("child_added",Y),Y=void 0),z&&(B.off("child_added",z),z=void 0),console.debug("(ReachSDK::webrtc::_initSdpCallbacks)isPublish="+e),e?(z=function(e){if(!ae&&"sdpAnswer"===e.name()){var t=e.val();console.debug("(ReachSDK::webrtc::sdpAnswerCb)stackId="+W+"-received sdpAnswer: "+(0,i["default"])(t)),U.setRemoteDescription(new Z(t),function(){console.debug("(ReachSDK::webrtc::sdpAnswerCb)stackId="+W+"-remote description set"),y()},S),B.off("child_added",z),z=void 0,e.ref().remove(),O(!1)}},B.on("child_added",z)):(Y=function(e){if(!ae&&"sdpOffer"===e.name()){var t=e.val();console.debug("(ReachSDK::webrtc::sdpOfferCb)stackId="+W+"-received sdpOffer: "+(0,i["default"])(t)),U.setRemoteDescription(new Z(t),function(){console.debug("(ReachSDK::webrtc::setRemoteDescription)"),U.createAnswer(function(e){console.log("(ReachSDK::webrtc::sdpOfferCb)stackId="+W+"-sending answer"),U.setLocalDescription(e,function(){console.debug("(ReachSDK::webrtc::sdpOfferCb)stackId="+W+"-set sdpAnswer in base : "+(0,i["default"])(e)),F.child("sdpAnswer").set(JSON.parse((0,i["default"])(e))),y()},S),setTimeout(function(){if(re=U.getRemoteStreams()[0],de&&C(),le&&k(),(U.iceConnectionState===l||U.iceConnectionState===f||U.iceConnectionState===m)&&re){for(var e=0;e<ne.length;e++)ne[e]&&attachMediaStream(ne[e],re);for(var t=0;t<oe.length;t++)oe[t]&&oe[t](re);oe=[]}},1100)},S,ve)},S),B.off("child_added",Y),Y=void 0,e.ref().remove(),O(!1)}},B.on("child_added",Y))}function P(){console.log("(webrtc::sendOffer)stackid="+W+"-creating sdpOffer"),U.createOffer(function(e){U.setLocalDescription(e,function(){console.debug("(ReachSDK::webrtc::createOffer)stackId="+W+"-set sdpOffer in base : "+(0,i["default"])(e)),F.child("sdpOffer").set(JSON.parse((0,i["default"])(e)))},S)},S,he)}function M(e){if(console.log("(ReachSDK::webrtc::_initlocalStream)stackId="+W+" get local video stream and renders to local video"),q){var t=void 0;q===c["default"].ACTION_TYPE_VIDEO?(t=function(){console.log("(ReachSDK::webrtc::_initlocalStream)initlocalStream_video"),ie=u["default"].getVideoStream(),u["default"].addStreamVideoListener(function(e){if(console.log("(ReachSDK::webrtc::addStreamVideoListener)"),U){"firefox"===webrtcDetectedBrowser?(console.log(webrtcDetectedBrowser),U.getSenders().forEach(function(e){return ie.getTracks().includes(e.track)&&U.removeTrack(e)})):U.removeStream(ie),ie=e,de&&C(),le&&k(),console.log(e),U.addStream(e);for(var t=0;t<te.length;t++)console.log("(ReachSDK::webrtc::addStreamVideoListener)stackId="+W+" rendering local AudioVideo to "+te[t].id),attachMediaStream(te[t],e);O(!0),P()}}),de&&C(),le&&k(),U.addStream(ie);for(var t=0;t<te.length;t++)console.log("(ReachSDK::webrtc::_initlocalStream)stackId="+W+" rendering local video to "+te[t].id),attachMediaStream(te[t],u["default"].getVideoStream());e&&"function"==typeof e&&e()},u["default"].getVideoStream()?t():(u["default"].addVideoListener(t),u["default"].initVideo())):q===c["default"].ACTION_TYPE_AUDIO?(t=function(){console.log("(ReachSDK::webrtc::_initlocalStream)initlocalStream_audio"),ie=u["default"].getAudioStream()&&u["default"].getAudioStream().clone&&"function"==typeof u["default"].getAudioStream().clone?u["default"].getAudioStream().clone():u["default"].getAudioStream(),de&&C(),le&&k(),U.addStream(ie);for(var t=0;t<te.length;t++)console.log("(ReachSDK::webrtc::_initlocalStream)stackId="+W+" rendering local Audio to "+te[t].id),attachMediaStream(te[t],u["default"].getAudioStream());e&&"function"==typeof e&&e()},u["default"].getAudioStream()?t():(u["default"].addAudioListener(t),u["default"].initAudio())):q===c["default"].ACTION_TYPE_AUDIO_VIDEO&&(t=function(){console.log("(ReachSDK::webrtc::_initlocalStream)initlocalStream_audio_video"),ie=u["default"].getAudioVideoStream(),u["default"].addStreamAudioVideoListener(function(e){if(console.log("(ReachSDK::webrtc::addStreamAudioVideoListener)"),U){"firefox"===webrtcDetectedBrowser?(console.log(webrtcDetectedBrowser),U.getSenders().forEach(function(e){return ie.getTracks().includes(e.track)&&U.removeTrack(e)})):U.removeStream(ie),ie=e,de&&C(),le&&k(),console.log(e),U.addStream(e);for(var t=0;t<te.length;t++)console.log("(ReachSDK::webrtc::addStreamAudioVideoListener)stackId="+W+" rendering local AudioVideo to "+te[t].id),attachMediaStream(te[t],e);O(!0),P()}}),de&&C(),le&&k(),U.addStream(ie);for(var t=0;t<te.length;t++)console.log("(ReachSDK::webrtc::_initlocalStream)stackId="+W+" rendering local AudioVideo to "+te[t].id),attachMediaStream(te[t],u["default"].getAudioVideoStream());e&&"function"==typeof e&&e()},u["default"].getAudioVideoStream()?t():(u["default"].addAudioVideoListener(t),u["default"].initAudioVideo()))}else console.warn("(ReachSDK::webrtc::_initlocalStream)no actionType specified")}function A(){z&&(B.off("child_added",z),z=null),Y&&(B.off("child_added",Y),Y=null)}function x(e){if(ce||ae)console.debug("(ReachSDK::webrtc::_close)stackId="+W+"-closing webrtc stack already in progress");else{ce=!0,ue=e,console.debug("(ReachSDK::webrtc::_close)stackId="+W+"-closing webrtc stack"),U&&U.close(),J&&(B.off("child_added",J),J=null),G&&(_(),G=null),A();for(var t=0;t<te.length;t++)te[t]&&(detachMediaStream(te[t]),console.debug("(ReachSDK::webrtc::_close)stackId="+W+"-stopping local video to "+te[t].id));for(var n=0;n<ne.length;n++)ne[n]&&(detachMediaStream(ne[n]),console.debug("(ReachSDK::webrtc::_close)stackId="+W+"-stopping remote vid to "+ne[n].id));ae=!0,console.debug("(ReachSDK::webrtc::_close)stackId="+W+"-closing webrtc stack -> waiting for ICE_CONNECTION_STATE_DISCONNECTED"),!ae||se!==d&&se!==h&&se!==v||(console.debug("(ReachSDK::webrtc::_close)stackId="+W+"-closed webrtc stack complete"),U=null,ce=!1,V.clearWebrtcStacks($),ue&&"function"==typeof ue&&ue())}}function K(e,t){q&&(q===c["default"].ACTION_TYPE_VIDEO?u["default"].connectLocalVideoStream(e,t):q===c["default"].ACTION_TYPE_AUDIO?u["default"].connectLocalAudioStream(e,t):q===c["default"].ACTION_TYPE_AUDIO_VIDEO&&u["default"].connectLocalAudioVideoStream(e,t))}function L(e,t){e?re?(attachMediaStream(e,re),t&&"function"==typeof t&&t(re)):(ne.push(e),t&&"function"==typeof t&&oe.push(t)):re?t&&"function"==typeof t&&t(re):t&&"function"==typeof t&&oe.push(t)}function j(){console.log("(ReachSDK::webrtc::init_pc)stackId="+W+"_config=",(0,i["default"])(Q)),U=new X(Q,pe),U.onicecandidate=function(e){e.candidate&&(console.log("(ReachSDK::webrtc::pc.onicecandidate)stackId="+W+" send ice candidate="+(0,i["default"])(e.candidate)),F.child("iceCandidatesList").push({label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}))},U.onaddstream=function(e){if(console.debug("(ReachSDK::webrtc::onaddstream)stackId="+W+"-stream:"+(0,i["default"])(e.stream)),e&&e.stream&&(re=e.stream,de&&C(),le&&k()),(U.iceConnectionState===l||U.iceConnectionState===f||U.iceConnectionState===m)&&re){for(var t=0;t<ne.length;t++)ne[t]&&attachMediaStream(ne[t],re);for(var n=0;n<oe.length;n++)oe[n]&&oe[n](re);oe=[]}},U.oniceconnectionstatechange=function(){U&&U.iceConnectionState===p?(console.debug("(ReachSDK::webrtc::oniceconnectionstatechange)stackId="+W+"-checking"),se=p):U&&U.iceConnectionState===l?(se=l,console.debug("(ReachSDK::webrtc::oniceconnectionstatechange)stackId="+W+"-connected"),re&&(ne.forEach(function(e){e&&(console.debug("(ReachSDK::webrtc::onaddstream)pc.onaddstream stackId="+W+"-rendering remote vid to "+e.id),attachMediaStream(e,re))}),oe.forEach(function(e){e&&e(re)}),oe=[]),_()):U&&U.iceConnectionState===f&&(se=f,console.debug("(ReachSDK::webrtc::oniceconnectionstatechange)stackId="+W+"-"+f),_()),U&&U.iceConnectionState===d?(se=d,console.log("(ReachSDK::webrtc::oniceconnectionstatechange)stackId="+W+"-remote disconnection, closing peer connection")):U&&U.iceConnectionState===h?(console.debug("(ReachSDK::webrtc::oniceconnectionstatechange)stackId="+W+"-closed"),se=h,x()):U&&U.iceConnectionState===v?(console.debug("(ReachSDK::webrtc::oniceconnectionstatechange)stackId="+W+"-failed"),se=v):(U?console.debug("(ReachSDK::webrtc::oniceconnectionstatechange)stackId="+W+"-"+U.iceConnectionState):console.debug("(ReachSDK::webrtc::oniceconnectionstatechange)stackId="+W+"-pc = null"),se=m),!ae||se!==d&&se!==h&&se!==v||(console.debug("(ReachSDK::webrtc::_close)stackId="+W+"-closed webrtc stack complete"),U=null,ce=!1,V.clearWebrtcStacks($),H&&"function"==typeof H&&H(),ue&&"function"==typeof ue&&ue())},G=function(e){var t=e.val(),n=new ee({sdpMLineIndex:t.label,candidate:t.candidate,sdpMid:t.id});console.log("(ReachSDK::webrtc::iceCandidatesListCb)stackId="+W+"received ice candidate="+(0,i["default"])(n)),U.addIceCandidate(n)},N?M(function(){O(N),P()}):O(!1)}var V=e,W=(new Date).getTime(),N=t,U=null,F=n,B=o,G=null,Y=null,z=null,J=null,H=null,$=r,q=a,Q=null,X=null,Z=null,ee=null,te=[],ne=[],oe=[],re=null,ie=null,ae=!1,ce=!1,se=null,ue=null,de=!1,le=!1;console.log("(ReachSDK::webrtc::)stackId=${stackId} isPublish=${isPublish},localDataRef=${localDataRef},remoteDataRef=${remoteDataRef})");var fe={DtlsSrtpKeyAgreement:!0},pe={optional:[fe]},he={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},ve={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};return function(){if(console.log("(ReachSDK::webrtc::init)stackId="+W),"function"!=typeof RTCPeerConnection)throw console.error("(ReachSDK::webrtc::init)stackId="+W+" error=Webrtc is not supported on this browser !"),new Error("Webrtc is not supported on this browser !");if(X=RTCPeerConnection,"function"!=typeof RTCSessionDescription)throw console.error("(ReachSDK::webrtc::init)stackId="+W+" error2=Webrtc is not supported on this browser !"),new Error("Webrtc is not supported on this browser !");if(Z=RTCSessionDescription,"function"!=typeof RTCIceCandidate)throw console.error("(ReachSDK::webrtc::init)stackId="+W+" error3=Webrtc is not supported on this browser !"),new Error("Webrtc is not supported on this browser !");ee=RTCIceCandidate,s&&(de=!0),b&&(le=!0),w(function(e){Q=e,console.log("(ReachSDK::webrtc::) use server config=",(0,i["default"])(Q)),j()},function(){"undefined"!=typeof g?(Q=g,console.log("(ReachSDK::webrtc::) use DEFAULT_ICE_CONFIG config=",(0,i["default"])(Q))):console.log("(ReachSDK::webrtc::) no ice  config"),j()})}(),{setOnClose:function(e){H=e},close:function(e){console.debug("(ReachSDK::webrtc::_close)stackId="+W+"-close requested"),x(e)},connectLocalStream:K,connectRemoteStream:L,muteAudio:C,unmuteAudio:D,muteVideo:k,unmuteVideo:E}};t["default"]=b},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(23),i=o(r),a=n(58),c=o(a),s=function(e){function t(t,n,o,r,a,s,u,d,l,v){var m=s,g=e.getWebrtc().child(u+"/"+i["default"].appInstanceId),b=e.getWebrtc().child(u+"/"+n),S=void 0;S=r?{webRtcStackId:m,localVid:t}:{webRtcStackId:m,remoteVid:t};var w=p.push(S)-1;if(f[m])console.debug("ReachSDK::webrtcmngr::createWebrtc->use existing real webrtcStack"),r?(f[m].isPublished++,f[m].stack.connectLocalStream(t,v)):(f[m].isSubscribed++,f[m].stack.connectRemoteStream(t,v));else{console.debug("ReachSDK::webrtcmngr::createWebrtc->create a new real webrtcStack");var y=(0,c["default"])(h,r,g,b,m,a,d,l);y.setOnClose(o),r?(f[m]={stack:y,isPublished:1,isSubscribed:0},y.connectLocalStream(t,v)):(f[m]={stack:y,isPublished:0,isSubscribed:1},y.connectRemoteStream(t,v))}return console.debug("ReachSDK::webrtcmngr::createWebrtc->webrtcStack:"+m+" new isPublished count ="+f[m].isPublished+" new isSubscribed count ="+f[m].isSubscribed),w}function n(e,t,n){if(console.debug("ReachSDK::webrtcmngr::closeWebrtc->id="+e),!p[e])return console.warn("ReachSDK::webrtcmngr::closeWebrtc: virtualstack "+e+" not found"),n&&"function"==typeof n&&n(),!1;var o=p[e].webRtcStackId;return o&&f[o]?(t&&f[o].isPublished>0?f[o].isPublished--:!t&&f[o].isSubscribed>0&&f[o].isSubscribed--,f[o].isPublished<1&&f[o].isSubscribed<1?(console.debug("ReachSDK::webrtcmngr::closeWebrtc->destroy  real webrtcStack:"+o),f[o].stack.close(n),f[o]=null):(console.debug("ReachSDK::webrtcmngr::closeWebrtc->decrement  real webrtcStack:"+o+" new isPublished count ="+f[o].isPublished+" new isSubscribed count ="+f[o].isSubscribed),n&&"function"==typeof n&&n())):(n&&"function"==typeof n&&n(),console.warn("ReachSDK::webrtcmngr::closeWebrtc cannot found real stack")),p[e].remoteVid&&detachMediaStream(p[e].remoteVid),p.splice(e,1),!0}function o(e){return console.debug("ReachSDK::webrtcmngr::clearWebrtcStacks id="+e),e&&f&&f[e]&&(f[e]=null),!0}function r(e){if(console.log("(ReachSDK::webrtcmngr::muteAudioWebrtcStack) virtualWebrtcStackId="+e),p&&p[e]&&p[e].webRtcStackId){var t=p[e].webRtcStackId;console.log("(ReachSDK::webrtcmngr::muteAudioWebrtcStack) virtualWebrtcStackId="+e+" webRtcStackId="+t),f&&f[t]&&f[t].stack?f[t].stack.muteAudio():console.warn("(ReachSDK::webrtcmngr::muteAudioWebrtcStack) webrtcStack="+t+" not found")}else console.warn("(ReachSDK::webrtcmngr::muteAudioWebrtcStack) virtualWebrtcStackId="+e+" not found")}function a(e){if(console.log("(ReachSDK::webrtcmngr::_unmuteAudioWebrtcStack) virtualWebrtcStackId="+e),p&&p[e]&&p[e].webRtcStackId){var t=p[e].webRtcStackId;console.log("(ReachSDK::webrtcmngr::_unmuteAudioWebrtcStack) virtualWebrtcStackId="+e+",webRtcStackId="+t),f&&f[t]&&f[t].stack?f[t].stack.unmuteAudio():console.warn("(ReachSDK::webrtcmngr::_unmuteAudioWebrtcStack) webrtcStack="+t+" not found")}else console.warn("(ReachSDK::webrtcmngr::_unmuteAudioWebrtcStack) virtualWebrtcStackId="+e+" not found")}function s(e){if(console.log("(ReachSDK::webrtcmngr::muteAudioWebrtcStack) virtualWebrtcStackId="+e),p&&p[e]&&p[e].webRtcStackId){var t=p[e].webRtcStackId;console.log("(ReachSDK::webrtcmngr::muteAudioWebrtcStack) virtualWebrtcStackId="+e+" webRtcStackId="+t),f&&f[t]&&f[t].stack?f[t].stack.muteVideo():console.warn("(ReachSDK::webrtcmngr::muteAudioWebrtcStack) webrtcStack="+t+" not found")}else console.warn("(ReachSDK::webrtcmngr::muteAudioWebrtcStack) virtualWebrtcStackId="+e+" not found")}function u(e){if(console.log("(ReachSDK::webrtcmngr::_unmuteAudioWebrtcStack) virtualWebrtcStackId="+e),p&&p[e]&&p[e].webRtcStackId){var t=p[e].webRtcStackId;console.log("(ReachSDK::webrtcmngr::_unmuteAudioWebrtcStack) virtualWebrtcStackId="+e+", webRtcStackId="+t),f&&f[t]&&f[t].stack?f[t].stack.unmuteVideo():console.warn("(ReachSDK::webrtcmngr::_unmuteAudioWebrtcStack) webrtcStack="+t+" not found")}else console.warn("(ReachSDK::webrtcmngr::_unmuteAudioWebrtcStack) virtualWebrtcStackId="+e+" not found")}function d(e){h=e}var l=this,f=[],p=[],h=void 0;return{createWebrtc:function(e,n,o,r,i,a,c,s,u,d){return t.bind(l)(e,n,o,r,i,a,c,s,u,d)},closeWebrtc:n,clearWebrtcStacks:o,muteAudioWebrtcStack:r,unmuteAudioWebrtcStack:a,muteVideoWebrtcStack:s,unmuteVideoWebrtcStack:u,setWebrtcManger:d}};t["default"]=s},function(e,t,n){e.exports={"default":n(67),__esModule:!0}},function(e,t,n){e.exports={"default":n(70),__esModule:!0}},function(e,t,n){e.exports={"default":n(71),__esModule:!0}},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(60),i=o(r);t["default"]=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),(0,i["default"])(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(62),i=o(r),a=n(61),c=o(a),s="function"==typeof c["default"]&&"symbol"==typeof i["default"]?function(e){return typeof e}:function(e){return e&&"function"==typeof c["default"]&&e.constructor===c["default"]?"symbol":typeof e};t["default"]="function"==typeof c["default"]&&"symbol"===s(i["default"])?function(e){return"undefined"==typeof e?"undefined":s(e)}:function(e){return e&&"function"==typeof c["default"]&&e.constructor===c["default"]?"symbol":"undefined"==typeof e?"undefined":s(e)}},function(e,t,n){var o=n(3),r=o.JSON||(o.JSON={stringify:JSON.stringify});e.exports=function(e){return r.stringify.apply(r,arguments)}},function(e,t,n){n(100);var o=n(3).Object;e.exports=function(e,t,n){return o.defineProperty(e,t,n)}},function(e,t,n){n(101),e.exports=n(3).Object.keys},function(e,t,n){n(51),n(52),n(53),n(102),e.exports=n(3).Promise},function(e,t,n){n(103),n(51),n(104),n(105),e.exports=n(3).Symbol},function(e,t,n){n(52),n(53),e.exports=n(35).f("iterator")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t,n,o){if(!(e instanceof t)||void 0!==o&&o in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var o=n(9),r=n(49),i=n(97);e.exports=function(e){return function(t,n,a){var c,s=o(t),u=r(s.length),d=i(a,u);if(e&&n!=n){for(;u>d;)if(c=s[d++],c!=c)return!0}else for(;u>d;d++)if((e||d in s)&&s[d]===n)return e||d||0;return!e&&-1}}},function(e,t,n){var o=n(16),r=n(45),i=n(29);e.exports=function(e){var t=o(e),n=r.f;if(n)for(var a,c=n(e),s=i.f,u=0;c.length>u;)s.call(e,a=c[u++])&&t.push(a);return t}},function(e,t,n){var o=n(12),r=n(81),i=n(79),a=n(4),c=n(49),s=n(98),u={},d={},t=e.exports=function(e,t,n,l,f){var p,h,v,m,g=f?function(){return e}:s(e),b=o(n,l,t?2:1),S=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(i(g)){for(p=c(e.length);p>S;S++)if(m=t?b(a(h=e[S])[0],h[1]):b(e[S]),m===u||m===d)return m}else for(v=g.call(e);!(h=v.next()).done;)if(m=r(v,b,h.value,t),m===u||m===d)return m};t.BREAK=u,t.RETURN=d},function(e,t){e.exports=function(e,t,n){var o=void 0===n;switch(t.length){case 0:return o?e():e.call(n);case 1:return o?e(t[0]):e.call(n,t[0]);case 2:return o?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return o?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return o?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var o=n(11);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==o(e)?e.split(""):Object(e)}},function(e,t,n){var o=n(15),r=n(1)("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||i[r]===e)}},function(e,t,n){var o=n(11);e.exports=Array.isArray||function(e){return"Array"==o(e)}},function(e,t,n){var o=n(4);e.exports=function(e,t,n,r){try{return r?t(o(n)[0],n[1]):t(n)}catch(i){var a=e["return"];throw void 0!==a&&o(a.call(e)),i}}},function(e,t,n){"use strict";var o=n(42),r=n(19),i=n(20),a={};n(8)(a,n(1)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=o(a,{next:r(1,n)}),i(e,t+" Iterator")}},function(e,t,n){var o=n(1)("iterator"),r=!1;try{var i=[7][o]();i["return"]=function(){r=!0},Array.from(i,function(){throw 2})}catch(a){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var i=[7],a=i[o]();a.next=function(){return{done:n=!0}},i[o]=function(){return a},e(i)}catch(c){}return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var o=n(16),r=n(9);e.exports=function(e,t){for(var n,i=r(e),a=o(i),c=a.length,s=0;c>s;)if(i[n=a[s++]]===t)return n}},function(e,t,n){var o=n(21)("meta"),r=n(10),i=n(7),a=n(6).f,c=0,s=Object.isExtensible||function(){return!0},u=!n(14)(function(){return s(Object.preventExtensions({}))}),d=function(e){a(e,o,{value:{i:"O"+ ++c,w:{}}})},l=function(e,t){if(!r(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,o)){if(!s(e))return"F";if(!t)return"E";d(e)}return e[o].i},f=function(e,t){if(!i(e,o)){if(!s(e))return!0;if(!t)return!1;d(e)}return e[o].w},p=function(e){return u&&h.NEED&&s(e)&&!i(e,o)&&d(e),e},h=e.exports={KEY:o,NEED:!1,fastKey:l,getWeak:f,onFreeze:p}},function(e,t,n){var o=n(2),r=n(48).set,i=o.MutationObserver||o.WebKitMutationObserver,a=o.process,c=o.Promise,s="process"==n(11)(a);e.exports=function(){var e,t,n,u=function(){var o,r;for(s&&(o=a.domain)&&o.exit();e;){r=e.fn,e=e.next;try{r()}catch(i){throw e?n():t=void 0,i}}t=void 0,o&&o.enter()};if(s)n=function(){a.nextTick(u)};else if(i){var d=!0,l=document.createTextNode("");new i(u).observe(l,{characterData:!0}),n=function(){l.data=d=!d}}else if(c&&c.resolve){var f=c.resolve();n=function(){f.then(u)}}else n=function(){r.call(o,u)};return function(o){var r={fn:o,next:void 0};t&&(t.next=r),e||(e=r,n()),t=r}}},function(e,t,n){var o=n(6),r=n(4),i=n(16);e.exports=n(5)?Object.defineProperties:function(e,t){r(e);for(var n,a=i(t),c=a.length,s=0;c>s;)o.f(e,n=a[s++],t[n]);return e}},function(e,t,n){var o=n(9),r=n(44).f,i={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(e){try{return r(e)}catch(t){return a.slice()}};e.exports.f=function(e){return a&&"[object Window]"==i.call(e)?c(e):r(o(e))}},function(e,t,n){var o=n(7),r=n(50),i=n(30)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=r(e),o(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,n){var o=n(13),r=n(3),i=n(14);e.exports=function(e,t){var n=(r.Object||{})[e]||Object[e],a={};a[e]=t(n),o(o.S+o.F*i(function(){n(1)}),"Object",a)}},function(e,t,n){var o=n(8);e.exports=function(e,t,n){for(var r in t)n&&e[r]?e[r]=t[r]:o(e,r,t[r]);return e}},function(e,t,n){var o=n(10),r=n(4),i=function(e,t){if(r(e),!o(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,o){try{o=n(12)(Function.call,n(43).f(Object.prototype,"__proto__").set,2),o(e,[]),t=!(e instanceof Array)}catch(r){t=!0}return function(e,n){return i(e,n),t?e.__proto__=n:o(e,n),e}}({},!1):void 0),check:i}},function(e,t,n){"use strict";var o=n(2),r=n(3),i=n(6),a=n(5),c=n(1)("species");e.exports=function(e){var t="function"==typeof r[e]?r[e]:o[e];a&&t&&!t[c]&&i.f(t,c,{configurable:!0,get:function(){return this}})}},function(e,t,n){var o=n(4),r=n(25),i=n(1)("species");e.exports=function(e,t){var n,a=o(e).constructor;return void 0===a||void 0==(n=o(a)[i])?t:r(n)}},function(e,t,n){var o=n(32),r=n(26);e.exports=function(e){return function(t,n){var i,a,c=String(r(t)),s=o(n),u=c.length;return 0>s||s>=u?e?"":void 0:(i=c.charCodeAt(s),55296>i||i>56319||s+1===u||(a=c.charCodeAt(s+1))<56320||a>57343?e?c.charAt(s):i:e?c.slice(s,s+2):(i-55296<<10)+(a-56320)+65536)}}},function(e,t,n){var o=n(32),r=Math.max,i=Math.min;e.exports=function(e,t){return e=o(e),0>e?r(e+t,0):i(e,t)}},function(e,t,n){var o=n(38),r=n(1)("iterator"),i=n(15);e.exports=n(3).getIteratorMethod=function(e){return void 0!=e?e[r]||e["@@iterator"]||i[o(e)]:void 0}},function(e,t,n){"use strict";var o=n(72),r=n(84),i=n(15),a=n(9);e.exports=n(41)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,r(1)):"keys"==t?r(0,n):"values"==t?r(0,e[n]):r(0,[n,e[n]])},"values"),i.Arguments=i.Array,o("keys"),o("values"),o("entries")},function(e,t,n){var o=n(13);o(o.S+o.F*!n(5),"Object",{defineProperty:n(6).f})},function(e,t,n){var o=n(50),r=n(16);n(91)("keys",function(){return function(e){return r(o(e))}})},function(e,t,n){"use strict";var o,r,i,a=n(18),c=n(2),s=n(12),u=n(38),d=n(13),l=n(10),f=(n(4),n(25)),p=n(73),h=n(76),v=(n(93).set,n(95)),m=n(48).set,g=n(87)(),b="Promise",S=c.TypeError,w=c.process,y=c[b],w=c.process,_="process"==u(w),R=function(){},I=!!function(){try{var e=y.resolve(1),t=(e.constructor={})[n(1)("species")]=function(e){e(R,R)};return(_||"function"==typeof PromiseRejectionEvent)&&e.then(R)instanceof t}catch(o){}}(),C=function(e,t){return e===t||e===y&&t===i},D=function(e){var t;return l(e)&&"function"==typeof(t=e.then)?t:!1},T=function(e){return C(y,e)?new k(e):new r(e)},k=r=function(e){var t,n;this.promise=new e(function(e,o){if(void 0!==t||void 0!==n)throw S("Bad Promise constructor");t=e,n=o}),this.resolve=f(t),this.reject=f(n)},E=function(e){try{e()}catch(t){return{error:t}}},O=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var o=e._v,r=1==e._s,i=0,a=function(t){var n,i,a=r?t.ok:t.fail,c=t.resolve,s=t.reject,u=t.domain;try{a?(r||(2==e._h&&A(e),e._h=1),a===!0?n=o:(u&&u.enter(),n=a(o),u&&u.exit()),n===t.promise?s(S("Promise-chain cycle")):(i=D(n))?i.call(n,c,s):c(n)):s(o)}catch(d){s(d)}};n.length>i;)a(n[i++]);e._c=[],e._n=!1,t&&!e._h&&P(e)})}},P=function(e){m.call(c,function(){var t,n,o,r=e._v;if(M(e)&&(t=E(function(){_?w.emit("unhandledRejection",r,e):(n=c.onunhandledrejection)?n({promise:e,reason:r}):(o=c.console)&&o.error&&o.error("Unhandled promise rejection",r)}),e._h=_||M(e)?2:1),e._a=void 0,t)throw t.error})},M=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,o=0;n.length>o;)if(t=n[o++],t.fail||!M(t.promise))return!1;return!0},A=function(e){m.call(c,function(){var t;_?w.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},x=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},K=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw S("Promise can't be resolved itself");(t=D(e))?g(function(){var o={_w:n,_d:!1};try{t.call(e,s(K,o,1),s(x,o,1))}catch(r){x.call(o,r)}}):(n._v=e,n._s=1,O(n,!1))}catch(o){x.call({_w:n,_d:!1},o)}}};I||(y=function(e){p(this,y,b,"_h"),f(e),o.call(this);try{e(s(K,this,1),s(x,this,1))}catch(t){x.call(this,t)}},o=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},o.prototype=n(92)(y.prototype,{then:function(e,t){var n=T(v(this,y));return n.ok="function"==typeof e?e:!0,n.fail="function"==typeof t&&t,n.domain=_?w.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&O(this,!1),n.promise},"catch":function(e){return this.then(void 0,e)}}),k=function(){var e=new o;this.promise=e,this.resolve=s(K,e,1),this.reject=s(x,e,1)}),d(d.G+d.W+d.F*!I,{Promise:y}),n(20)(y,b),n(94)(b),i=n(3)[b],d(d.S+d.F*!I,b,{reject:function(e){var t=T(this),n=t.reject;return n(e),t.promise}}),d(d.S+d.F*(a||!I),b,{resolve:function(e){if(e instanceof y&&C(e.constructor,this))return e;var t=T(this),n=t.resolve;return n(e),t.promise}}),d(d.S+d.F*!(I&&n(83)(function(e){y.all(e)["catch"](R)})),b,{all:function(e){var t=this,n=T(t),o=n.resolve,r=n.reject,i=E(function(){var n=[],i=0,a=1;h(e,!1,function(e){var c=i++,s=!1;n.push(void 0),a++,t.resolve(e).then(function(e){s||(s=!0,n[c]=e,--a||o(n))},r)}),--a||o(n)});return i&&r(i.error),n.promise},race:function(e){var t=this,n=T(t),o=n.reject,r=E(function(){h(e,!1,function(e){t.resolve(e).then(n.resolve,o)})});return r&&o(r.error),n.promise}})},function(e,t,n){"use strict";var o=n(2),r=n(7),i=n(5),a=n(13),c=n(47),s=n(86).KEY,u=n(14),d=n(31),l=n(20),f=n(21),p=n(1),h=n(35),v=n(34),m=n(85),g=n(75),b=n(80),S=n(4),w=n(9),y=n(33),_=n(19),R=n(42),I=n(89),C=n(43),D=n(6),T=n(16),k=C.f,E=D.f,O=I.f,P=o.Symbol,M=o.JSON,A=M&&M.stringify,x="prototype",K=p("_hidden"),L=p("toPrimitive"),j={}.propertyIsEnumerable,V=d("symbol-registry"),W=d("symbols"),N=d("op-symbols"),U=Object[x],F="function"==typeof P,B=o.QObject,G=!B||!B[x]||!B[x].findChild,Y=i&&u(function(){
return 7!=R(E({},"a",{get:function(){return E(this,"a",{value:7}).a}})).a})?function(e,t,n){var o=k(U,t);o&&delete U[t],E(e,t,n),o&&e!==U&&E(U,t,o)}:E,z=function(e){var t=W[e]=R(P[x]);return t._k=e,t},J=F&&"symbol"==typeof P.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof P},H=function(e,t,n){return e===U&&H(N,t,n),S(e),t=y(t,!0),S(n),r(W,t)?(n.enumerable?(r(e,K)&&e[K][t]&&(e[K][t]=!1),n=R(n,{enumerable:_(0,!1)})):(r(e,K)||E(e,K,_(1,{})),e[K][t]=!0),Y(e,t,n)):E(e,t,n)},$=function(e,t){S(e);for(var n,o=g(t=w(t)),r=0,i=o.length;i>r;)H(e,n=o[r++],t[n]);return e},q=function(e,t){return void 0===t?R(e):$(R(e),t)},Q=function(e){var t=j.call(this,e=y(e,!0));return this===U&&r(W,e)&&!r(N,e)?!1:t||!r(this,e)||!r(W,e)||r(this,K)&&this[K][e]?t:!0},X=function(e,t){if(e=w(e),t=y(t,!0),e!==U||!r(W,t)||r(N,t)){var n=k(e,t);return!n||!r(W,t)||r(e,K)&&e[K][t]||(n.enumerable=!0),n}},Z=function(e){for(var t,n=O(w(e)),o=[],i=0;n.length>i;)r(W,t=n[i++])||t==K||t==s||o.push(t);return o},ee=function(e){for(var t,n=e===U,o=O(n?N:w(e)),i=[],a=0;o.length>a;)r(W,t=o[a++])&&(n?r(U,t):!0)&&i.push(W[t]);return i};F||(P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function(n){this===U&&t.call(N,n),r(this,K)&&r(this[K],e)&&(this[K][e]=!1),Y(this,e,_(1,n))};return i&&G&&Y(U,e,{configurable:!0,set:t}),z(e)},c(P[x],"toString",function(){return this._k}),C.f=X,D.f=H,n(44).f=I.f=Z,n(29).f=Q,n(45).f=ee,i&&!n(18)&&c(U,"propertyIsEnumerable",Q,!0),h.f=function(e){return z(p(e))}),a(a.G+a.W+a.F*!F,{Symbol:P});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)p(te[ne++]);for(var te=T(p.store),ne=0;te.length>ne;)v(te[ne++]);a(a.S+a.F*!F,"Symbol",{"for":function(e){return r(V,e+="")?V[e]:V[e]=P(e)},keyFor:function(e){if(J(e))return m(V,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){G=!0},useSimple:function(){G=!1}}),a(a.S+a.F*!F,"Object",{create:q,defineProperty:H,defineProperties:$,getOwnPropertyDescriptor:X,getOwnPropertyNames:Z,getOwnPropertySymbols:ee}),M&&a(a.S+a.F*(!F||u(function(){var e=P();return"[null]"!=A([e])||"{}"!=A({a:e})||"{}"!=A(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!J(e)){for(var t,n,o=[e],r=1;arguments.length>r;)o.push(arguments[r++]);return t=o[1],"function"==typeof t&&(n=t),!n&&b(t)||(t=function(e,t){return n&&(t=n.call(this,e,t)),J(t)?void 0:t}),o[1]=t,A.apply(M,o)}}}),P[x][L]||n(8)(P[x],L,P[x].valueOf),l(P,"Symbol"),l(Math,"Math",!0),l(o.JSON,"JSON",!0)},function(e,t,n){n(34)("asyncIterator")},function(e,t,n){n(34)("observable")}])});